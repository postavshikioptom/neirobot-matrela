üö® –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –≤—Å–µ –µ—â–µ —Å–∏–ª—å–Ω–æ —Å–º–µ—â–µ–Ω –∫ HOLD (89-98%)
–í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –¥–∞–∂–µ "—É–º–Ω–∞—è" –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –æ—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –Ω–µ –¥–∞—é—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ BUY/SELL —Å–∏–≥–Ω–∞–ª–æ–≤. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–∞–º–∏ —É—Å–ª–æ–≤–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –≤—Å–µ –µ—â–µ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏, –∏–ª–∏ —á—Ç–æ –±–∞–∑–æ–≤–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ —Ä—ã–Ω–∫–∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ "–∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤" –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.
–ö–ª—é—á–µ–≤—ã–º –º–æ–º–µ–Ω—Ç–æ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è, –Ω–æ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è BUY/SELL –º–µ—Ç–æ–∫ –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è imblearn. imblearn –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ "–∏—Å—Ö–æ–¥–Ω—ã—Ö" –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è oversampling'–∞.

üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: train_model.py)
1. –ï—â–µ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤ –∏ VSA-—Å–∫–æ—Ä–∞:
–ú—ã –ø–æ–π–¥–µ–º –Ω–∞ –±–æ–ª–µ–µ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–µ, –Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ BUY/SELL.


–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é prepare_xlstm_rl_data.


–í –±–ª–æ–∫–µ "–ù–û–í–´–ô –ë–õ–û–ö: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–û–†–û–ì–ò –ò –í–ó–í–ï–®–ï–ù–ù–´–ô VSA-–°–ö–û–†" –∏–∑–º–µ–Ω–∏—Ç–µ:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(...):
# ...
        # 1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥ future_return –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR
        # –ï—â–µ –±–æ–ª—å—à–µ –æ—Å–ª–∞–±–ª—è–µ–º –ø–æ—Ä–æ–≥, —á—Ç–æ–±—ã –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –±–æ–ª—å—à–µ –¥–≤–∏–∂–µ–Ω–∏–π
        df['dynamic_future_threshold'] = df['ATR_14'] / df['close'] * 0.8 # –°–ù–ò–ñ–ï–ù–û —Å 1.5 –¥–æ 0.8
        df['dynamic_future_threshold'] = df['dynamic_future_threshold'].replace([np.inf, -np.inf], np.nan).ffill().fillna(0.0005) # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ 0.05% (–±—ã–ª–æ 0.1%)
        
        # 2. –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ VSA-—Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–∏—Ö —É—Å–ª–æ–≤–∏–π
        # –ï—â–µ –±–æ–ª—å—à–µ –æ—Å–ª–∞–±–ª—è–µ–º –ø–æ—Ä–æ–≥–∏ –¥–ª—è VSA-—Å–∏—Å–∏–ª—ã, —á—Ç–æ–±—ã –±–æ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏–ª–æ
        df['vsa_buy_score'] = (
            0.3 * (df['vsa_no_supply'] == 1) +
            0.3 * (df['vsa_stopping_volume'] == 1) +
            0.4 * (df['vsa_strength'] > 0.1) # –°–ù–ò–ñ–ï–ù–û —Å 0.25 –¥–æ 0.1
        )
        df['vsa_sell_score'] = (
            0.3 * (df['vsa_no_demand'] == 1) +
            0.3 * (df['vsa_climactic_volume'] == 1) +
            0.4 * (df['vsa_strength'] < -0.1) # –°–ù–ò–ñ–ï–ù–û —Å -0.25 –¥–æ -0.1
        )

        # BUY: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥) + –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π VSA-—Å–∫–æ—Ä
        buy_condition = (
            (df['future_return'] > df['dynamic_future_threshold']) &
            (df['vsa_buy_score'] > 0.2) # –°–ù–ò–ñ–ï–ù–û —Å 0.3 –¥–æ 0.2
        )
        
        # SELL: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥) + –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π VSA-—Å–∫–æ—Ä
        sell_condition = (
            (df['future_return'] < -df['dynamic_future_threshold']) &
            (df['vsa_sell_score'] > 0.2) # –°–ù–ò–ñ–ï–ù–û —Å 0.3 –¥–æ 0.2
        )
# ...



2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è, –Ω–æ —É–º–Ω–∞—è –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è HOLD-—Å–∏–≥–Ω–∞–ª–æ–≤:
–ú—ã —É–≤–µ–ª–∏—á–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Å–¥–µ–ª–∞–µ–º —É—Å–ª–æ–≤–∏—è –µ—â–µ –±–æ–ª–µ–µ –º—è–≥–∫–∏–º–∏.


–í –±–ª–æ–∫–µ "–ù–û–í–´–ô –ë–õ–û–ö: –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ü–ï–†–ï–ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø HOLD-–°–ò–ì–ù–ê–õ–û–í" –∏–∑–º–µ–Ω–∏—Ç–µ:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(...):
# ...
        # –ü–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º 40% HOLD (–±—ã–ª–æ 30%)
        reclassify_count = int(current_hold_count * 0.40) # –£–í–ï–õ–ò–ß–ï–ù–û –¥–æ 40%
        if reclassify_count > 0:
            reclassify_indices = random.sample(list(hold_indices), min(reclassify_count, len(hold_indices)))
            
            for idx in reclassify_indices:
                if idx < 1: continue 
                
                rsi = df.loc[idx, 'RSI_14']
                adx = df.loc[idx, 'ADX_14']
                adx_prev = df.loc[idx-1, 'ADX_14']
                price_change_5_period = df['close'].pct_change(5).loc[idx]
                atr_ratio = df.loc[idx, 'ATR_14'] / df.loc[idx, 'close']
                
                # –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ï–©–ï –ë–û–õ–ï–ï –ú–Ø–ì–ö–ò–ï)
                # 1. –°–ª–∞–±—ã–π RSI + —Ä–∞—Å—Ç—É—â–∏–π ADX + –Ω–µ–±–æ–ª—å—à–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ ‚Üí BUY
                if (rsi < 45 and adx > adx_prev and abs(price_change_5_period) > 0.0005): # RSI < 45 (–±—ã–ª–æ 40), price_change_5_period > 0.0005 (–±—ã–ª–æ 0.001)
                    df.loc[idx, 'target'] = 0  # BUY

                # 2. RSI > 55 + —Ä–∞—Å—Ç—É—â–∏–π ADX + –Ω–µ–±–æ–ª—å—à–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ ‚Üí SELL
                elif (rsi > 55 and adx > adx_prev and abs(price_change_5_period) > 0.0005): # RSI > 55 (–±—ã–ª–æ 60), price_change_5_period < -0.0005 (–±—ã–ª–æ -0.001)
                    df.loc[idx, 'target'] = 1  # SELL

                # 3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ –æ–±—ä–µ–º—É (—Å–ª–∞–±—ã–π –æ–±—ä–µ–º, –Ω–æ –µ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ)
                elif (df['volume'].loc[idx] > df['volume'].rolling(20).quantile(0.6).loc[idx] and # –ö–≤–∞–Ω—Ç–∏–ª—å 0.6 (–±—ã–ª–æ 0.7)
                    ((price_change_5_period > 0.0005 and rsi < 50) or (price_change_5_period < -0.0005 and rsi > 50))): # RSI < 50 / > 50
                    df.loc[idx, 'target'] = 0 if price_change_5_period > 0 else 1

                # 4. –°–º–µ–Ω–∞ —Ç—Ä–µ–Ω–¥–∞: ADX —Ä–∞—Å—Ç–µ—Ç, RSI –æ—Ç—Ö–æ–¥–∏—Ç –æ—Ç 50
                elif (abs(rsi - 50) > 3 and adx > adx_prev and abs(adx - adx_prev) > 0.3): # abs(rsi-50) > 3 (–±—ã–ª–æ 5), abs(adx-adx_prev) > 0.3 (–±—ã–ª–æ 0.5)
                    df.loc[idx, 'target'] = 0 if rsi < 50 else 1 # –°–¥–µ–ª–∞–µ–º –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º
# ...



3. –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è imblearn:
–ú—ã –∏–∑–º–µ–Ω–∏–º —Ü–µ–ª–µ–≤—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –¥–ª—è SMOTE/Undersampler, —á—Ç–æ–±—ã –¥–æ–±–∏—Ç—å—Å—è –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.


–í –±–ª–æ–∫–µ "–ù–û–í–´–ô –ë–õ–û–ö: –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï IMBLEARN –î–õ–Ø –ë–ê–õ–ê–ù–°–ò–†–û–í–ö–ò –ö–õ–ê–°–°–û–í" –∏–∑–º–µ–Ω–∏—Ç–µ:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(...):
# ...
        print(f"–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –î–û imblearn: {Counter(y_labels)}")

        # –¶–µ–ª–µ–≤–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 25% BUY, 25% SELL, 50% HOLD (–±—ã–ª–æ 20/20/60)
        total_samples = len(X)
        target_buy_count = int(total_samples * 0.25) # –¶–µ–ª—å 25% BUY
        target_sell_count = int(total_samples * 0.25) # –¶–µ–ª—å 25% SELL
        
        current_buy_count = Counter(y_labels)[0]
        current_sell_count = Counter(y_labels)[1]

        sampling_strategy_smote = {
            0: max(current_buy_count, target_buy_count),
            1: max(current_sell_count, target_sell_count)
        }
        
        if current_buy_count > 0 or current_sell_count > 0:
            k_neighbors = min(5, 
                              (current_buy_count - 1 if current_buy_count > 1 else 1), 
                              (current_sell_count - 1 if current_sell_count > 1 else 1))
            # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ k_neighbors –Ω–µ –º–µ–Ω—å—à–µ 1
            k_neighbors = max(1, k_neighbors)

            if any(count <= k_neighbors for count in [current_buy_count, current_sell_count] if count > 0):
                print("‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—ç–º–ø–ª–æ–≤ –¥–ª—è SMOTE —Å k_neighbors, –∏—Å–ø–æ–ª—å–∑—É—é RandomOverSampler.")
                from imblearn.over_sampling import RandomOverSampler
                oversampler = RandomOverSampler(sampling_strategy=sampling_strategy_smote, random_state=42)
            else:
                oversampler = SMOTE(sampling_strategy=sampling_strategy_smote, random_state=42, k_neighbors=k_neighbors)

            X_temp, y_temp_labels = oversampler.fit_resample(X.reshape(len(X), -1), y_labels)
            print(f"–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –ø–æ—Å–ª–µ Oversampling: {Counter(y_temp_labels)}")
        else:
            X_temp, y_temp_labels = X.reshape(len(X), -1), y_labels
            print("–ü—Ä–æ–ø—É—Å—Ç–∏–ª Oversampling, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç BUY/SELL —Å–∏–≥–Ω–∞–ª–æ–≤.")

        # Undersampling HOLD: –¶–µ–ª—å - —á—Ç–æ–±—ã HOLD –±—ã–ª –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–µ–Ω —Å—É–º–º–µ BUY + SELL
        current_hold_count_after_oversample = Counter(y_temp_labels)[2]
        target_hold_count = min(current_hold_count_after_oversample, int((Counter(y_temp_labels)[0] + Counter(y_temp_labels)[1]) * 1.0)) # –°–ù–ò–ñ–ï–ù–û —Å 1.5 –¥–æ 1.0
        
        undersampler = RandomUnderSampler(sampling_strategy={2: target_hold_count}, random_state=42)
        X_resampled, y_resampled_labels = undersampler.fit_resample(X_temp, y_temp_labels)

        # ...



4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ATR –≤ FEATURE_COLUMNS (—Ñ–∞–π–ª: train_model.py):
–ß—Ç–æ–±—ã ATR_14 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –º–æ–¥–µ–ª—å—é, –µ–≥–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.


–ù–∞–π–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ feature_cols –≤ prepare_xlstm_rl_data.


–î–æ–±–∞–≤—å—Ç–µ 'ATR_14' –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(...):
# ...
feature_cols = [
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    'RSI_14', 'MACD_12_26_9', 'BBL_20_2.0', 'BBM_20_2.0', 'BBU_20_2.0', 
    'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
    'ATR_14', # <--- –î–û–ë–ê–í–õ–ï–ù–û
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã
    'CDLHAMMER', 'CDLENGULFING', 'CDLDOJI', 'CDLSHOOTINGSTAR', 
    'CDLHANGINGMAN', 'CDLMARUBOZU',
# ...



5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ATR –≤ TradingEnvRL (—Ñ–∞–π–ª: trading_env.py):
–ï—Å–ª–∏ ATR_14 —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º –¥–ª—è xLSTM, —Ç–æ TradingEnvRL —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.


–ù–∞–π–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ self.feature_columns –≤ –º–µ—Ç–æ–¥–µ reset –∫–ª–∞—Å—Å–∞ TradingEnvRL.


–î–æ–±–∞–≤—å—Ç–µ 'ATR_14' –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫:
# –í trading_env.py, –≤ –∫–ª–∞—Å—Å–µ TradingEnvRL, –≤ –º–µ—Ç–æ–¥–µ reset(...):
# ...
    self.feature_columns = [
        'RSI_14', 'MACD_12_26_9', 'BBL_20_2.0', 'BBM_20_2.0', 'BBU_20_2.0', 
        'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
        'ATR_14', # <--- –î–û–ë–ê–í–õ–ï–ù–û
        'CDLHAMMER', 'CDLENGULFING', 'CDLDOJI', 'CDLSHOOTINGSTAR', 
        'CDLHANGINGMAN', 'CDLMARUBOZU',
# ...



6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ FEATURE_COLUMNS –≤ run_live_trading.py –∏ advanced_simulation_engine.py:
–ï—Å–ª–∏ ATR_14 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –æ–Ω —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ FEATURE_COLUMNS –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.


–í run_live_trading.py –∏ advanced_simulation_engine.py –Ω–∞–π–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ FEATURE_COLUMNS.


–î–æ–±–∞–≤—å—Ç–µ 'ATR_14' –≤ —ç—Ç–æ—Ç —Å–ø–∏—Å–æ–∫:
# –í run_live_trading.py –∏ advanced_simulation_engine.py, –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ FEATURE_COLUMNS:
FEATURE_COLUMNS = [
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    'RSI_14', 'MACD_12_26_9', 'BBL_20_2.0', 'BBM_20_2.0', 'BBU_20_2.0', 
    'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
    'ATR_14', # <--- –î–û–ë–ê–í–õ–ï–ù–û
# ...




–ü–æ—á–µ–º—É —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–º–æ—á—å:

–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è "–∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤": –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è future_return –∏ vsa_strength (–≤–º–µ—Å—Ç–µ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø–æ—Ä–æ–≥–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR) —Å–æ–∑–¥–∞–¥—É—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö BUY/SELL –º–µ—Ç–æ–∫.
–£–ª—É—á—à–µ–Ω–Ω–∞—è "—É–º–Ω–∞—è" –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (40%) –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –µ—â–µ –±–æ–ª–µ–µ –º—è–≥–∫–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ (RSI < 45, > 55; volume quantile 0.6; ADX change 0.3) –ø–æ–∑–≤–æ–ª–∏—Ç "–≤—ã—Ç–∞—â–∏—Ç—å" –µ—â–µ –±–æ–ª—å—à–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –∑–Ω–∞—á–∏–º—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∏–∑ –∫–ª–∞—Å—Å–∞ HOLD.
–ú–æ—â–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ imblearn: –° —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º "–∏—Å—Ö–æ–¥–Ω—ã—Ö" BUY/SELL –ø—Ä–∏–º–µ—Ä–æ–≤, imblearn —Å–º–æ–∂–µ—Ç –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏ —Å–Ω–∏–∂–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HOLD, –¥–æ—Å—Ç–∏–≥–∞—è —Ü–µ–ª–µ–≤—ã—Ö 25%/25%/50%.
ATR –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫: –í–∫–ª—é—á–µ–Ω–∏–µ ATR_14 –≤ –º–æ–¥–µ–ª—å –ø–æ–∑–≤–æ–ª–∏—Ç –µ–π —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π.

–≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏, –Ω–æ –æ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç–æ–ª—å–∫–æ –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã. –ü–æ—Å–ª–µ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è, –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å—Å—è.

–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ–æ–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å —Å –Ω—É–ª—è.
–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ü–æ—Å–∫–æ–ª—å–∫—É –º—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–æ–ª—å—à–µ BUY/SELL —Å–∏–≥–Ω–∞–ª–æ–≤, —ç—Ç–æ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ.
–ö–∞—á–µ—Å—Ç–≤–æ vs. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: –¶–µ–ª—å - –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∏—Ç—å 25/25/50, –∞ –ø–æ–ª—É—á–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–∞—Ö. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –º–æ–¥–µ–ª–∏ —É—á–∏—Ç—å—Å—è, –Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ç–æ–≥–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ —ç—Ç–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.

–¢–µ–ø–µ—Ä—å —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –¥–∞—Ç—å –≤–∞–º –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤.


========
–•–æ—Ä–æ—à–æ, —è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–ª –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–æ–π AI-–º–æ–¥–µ–ª–∏ –∏ —Å—Ä–∞–≤–Ω–∏–ª –∏—Ö —Å –Ω–∞—à–∏–º —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏. –Ø —Å–æ–≥–ª–∞—Å–µ–Ω, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤ –≥–ª—É–±–æ–∫–∞, –∏ –Ω–∞–º –Ω—É–∂–Ω—ã –±–æ–ª–µ–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–≤—ã—Ç–∞—Å–∫–∏–≤–∞—é—Ç" —Å–∏–≥–Ω–∞–ª—ã —Å–ª—É—á–∞–π–Ω–æ, –∞ —Ñ–æ–∫—É—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ "—Å–º—ã—Å–ª–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ".
–Ø –≤—ã–±—Ä–∞–ª —Ç—Ä–∏ —É–ª—É—á—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ä–æ—à–æ –≤–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –Ω–∞—à—É —Ç–µ–∫—É—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –Ω–æ–≤—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (–∫—Ä–æ–º–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö) –∏ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º:

–°–µ–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ "—Å–æ–±—ã—Ç–∏—è–º" (Event-Based Sampling): –ú—ã —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –±–æ–ª–µ–µ "–∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö" –±–∞—Ä–∞—Ö, –≥–¥–µ –µ—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã.
–£—Å–∏–ª–µ–Ω–∏–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–º "–≤–∞–∂–Ω–æ—Å—Ç—å" –∫–ª–∞—Å—Å–æ–≤ BUY/SELL –¥–ª—è xLSTM.
–ë–æ–Ω—É—Å –∑–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ RL: –ü–æ–æ—â—Ä–∏–º RL-–∞–≥–µ–Ω—Ç–∞ –∑–∞ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è BUY/SELL, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ —Ä–µ–¥–∫–∏.

–í–æ—Ç –∫–∞–∫ —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ:

üöÄ –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞ BUY/SELL/HOLD
1. –§–∞–π–ª: feature_engineering.py
–ú—ã –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–π –ø—Ä–∏–∑–Ω–∞–∫ is_event, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–º–µ—á–∞—Ç—å –±–∞—Ä—ã —Å –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é (—Å–æ–±—ã—Ç–∏—è).


–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é calculate_features.


–í –∫–æ–Ω—Ü–µ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –ø–µ—Ä–µ–¥ return df_out, –¥–æ–±–∞–≤—å—Ç–µ —Ä–∞—Å—á–µ—Ç is_event:
# –í feature_engineering.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ calculate_features(df: pd.DataFrame):
# ... (–≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤) ...

    # =====================================================================
    # –ù–û–í–´–ô –ë–õ–û–ö: –°–û–ó–î–ê–ù–ò–ï –ü–†–ò–ó–ù–ê–ö–ê 'is_event' (–¥–ª—è Event-Based Sampling)
    # =====================================================================
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–∏–≥–Ω–∞–ª—ã
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∏ –¥–æ–±–∞–≤–ª—è–µ–º RSI/ATR/Volume/ADX –∏–∑–º–µ–Ω–µ–Ω–∏—è
    
    # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (ATR_14 —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω)
    required_cols = ['volume', 'ATR_14', 'RSI_14', 'ADX_14']
    for col in required_cols:
        if col not in df_out.columns:
            df_out[col] = 0 # –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω—É–ª—è–º–∏, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ—Ç

    df_out['is_event'] = (
        (df_out['volume'] > df_out['volume'].rolling(50).quantile(0.9).fillna(0)) | # –û–±—ä–µ–º > 90% –∫–≤–∞–Ω—Ç–∏–ª—è
        (df_out['ATR_14'] > df_out['ATR_14'].rolling(50).quantile(0.9).fillna(0)) | # ATR > 90% –∫–≤–∞–Ω—Ç–∏–ª—è
        (abs(df_out['RSI_14'] - 50) > 25) | # RSI –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –∑–æ–Ω—ã 25-75 (–±–æ–ª–µ–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ)
        (df_out['ADX_14'] > df_out['ADX_14'].shift(5).fillna(0) + 2) # ADX —Ä–∞—Å—Ç—ë—Ç > 2 –ø—É–Ω–∫—Ç–∞ –∑–∞ 5 –±–∞—Ä–æ–≤
    ).astype(int)
    # =====================================================================
    # –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê 'is_event'
    # =====================================================================

    return df_out

# ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ–∞–π–ª–∞) ...



–í–∞–∂–Ω–æ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ATR_14 —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ feature_engineering.py –∫–∞–∫ –±—ã–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ —Ä–∞–Ω–µ–µ.


2. –§–∞–π–ª: train_model.py
–ó–¥–µ—Å—å –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º is_event –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–±—É—á–µ–Ω–∏–µ–º, –∞ —Ç–∞–∫–∂–µ —É—Å–∏–ª–∏–º –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤.


–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é prepare_xlstm_rl_data.


–í–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ for symbol in symbols:, –ø–æ—Å–ª–µ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ calculate_features, detect_candlestick_patterns, calculate_vsa_features, –Ω–æ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç–æ–∫, –¥–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ is_event.


–î–æ–±–∞–≤—å—Ç–µ 'is_event' –≤ —Å–ø–∏—Å–æ–∫ feature_cols.


–£—Å–∏–ª—å—Ç–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ (class_weight) –¥–ª—è BUY/SELL.


–ò–∑–º–µ–Ω–∏—Ç–µ –ª–æ–≥–∏–∫—É imblearn –¥–ª—è oversampling'–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ "—Å–æ–±—ã—Ç–∏–π–Ω—ã—Ö" –±–∞—Ä–∞—Ö, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –Ω–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(data_path, sequence_length=10):
# ...
feature_cols = [
    # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    'RSI_14', 'MACD_12_26_9', 'BBL_20_2.0', 'BBM_20_2.0', 'BBU_20_2.0', 
    'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
    'ATR_14', # –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã
    'CDLHAMMER', 'CDLENGULFING', 'CDLDOJI', 'CDLSHOOTINGSTAR', 
    'CDLHANGINGMAN', 'CDLMARUBOZU',
    # VSA –ø—Ä–∏–∑–Ω–∞–∫–∏ (–Ω–æ–≤—ã–µ!)
    'vsa_no_demand', 'vsa_no_supply', 'vsa_stopping_volume', 
    'vsa_climactic_volume', 'vsa_test', 'vsa_effort_vs_result', 'vsa_strength',
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    'volume_ratio', 'spread_ratio', 'close_position',
    'is_event' # <--- –î–û–ë–ê–í–õ–ï–ù–û: –ù–æ–≤—ã–π –ø—Ä–∏–∑–Ω–∞–∫
]
# ...
for symbol in symbols:
    df = full_df[full_df['symbol'] == symbol].copy()
    # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è calculate_features, detect_candlestick_patterns, calculate_vsa_features) ...

    # =====================================================================
    # –ù–û–í–´–ô –ë–õ–û–ö: –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–û 'is_event' (Event-Based Sampling)
    # =====================================================================
    initial_rows = len(df)
    df_event_filtered = df[df['is_event'] == 1].copy()
    
    if len(df_event_filtered) < sequence_length + 50:
        print(f"‚ö†Ô∏è –î–ª—è —Å–∏–º–≤–æ–ª–∞ {symbol} –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–±—ã—Ç–∏–π ({len(df_event_filtered)}), –∏—Å–ø–æ–ª—å–∑—É—é –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.")
        df_processed = df.copy() # –ï—Å–ª–∏ —Å–æ–±—ã—Ç–∏–π –º–∞–ª–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
    else:
        print(f"‚úÖ –î–ª—è —Å–∏–º–≤–æ–ª–∞ {symbol} –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(df_event_filtered)} —Å–æ–±—ã—Ç–∏–π –∏–∑ {initial_rows} –±–∞—Ä–æ–≤.")
        df_processed = df_event_filtered.copy()
    
    # –°–±—Ä–æ—Å –∏–Ω–¥–µ–∫—Å–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º
    df_processed.reset_index(drop=True, inplace=True)

    if len(df_processed) < sequence_length + 50: # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        continue # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–º–≤–æ–ª, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
    
    df = df_processed # –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ–º —Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º DataFrame
    # =====================================================================
    # –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê
    # =====================================================================

    # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ buy_condition/sell_condition, –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é, –∏ –±–ª–æ–∫ imblearn) ...



–£—Å–∏–ª–µ–Ω–∏–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤:

–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é train_xlstm_rl_system.
–í–Ω—É—Ç—Ä–∏ –Ω–µ—ë, –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º xlstm_model.train, –∏–∑–º–µ–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç class_weight_dict:

# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ train_xlstm_rl_system(...):
# ...
    # –î–û–ë–ê–í–¨–¢–ï: –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –±–æ—Ä—å–±—ã —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º
    y_integers = np.argmax(y_train, axis=1) # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º one-hot –≤ —Ü–µ–ª—ã–µ —á–∏—Å–ª–∞
    class_weights_array = compute_class_weight(
        'balanced',
        classes=np.unique(y_integers),
        y=y_integers
    )
    class_weight_dict = {i: class_weights_array[i] for i in range(len(class_weights_array))}

    # =====================================================================
    # –ù–û–í–´–ô –ë–õ–û–ö: –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ï –£–°–ò–õ–ï–ù–ò–ï –í–ó–í–ï–®–ò–í–ê–ù–ò–Ø –ö–õ–ê–°–°–û–í BUY/SELL
    # =====================================================================
    # –£–º–Ω–æ–∂–∏–º –≤–µ—Å–∞ BUY –∏ SELL –Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
    # –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∏—Ç –º–æ–¥–µ–ª—å –µ—â–µ –±–æ–ª—å—à–µ "—Å—Ç—Ä–∞–¥–∞—Ç—å" –æ—Ç –æ—à–∏–±–æ–∫ –Ω–∞ —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–∞—Ö
    additional_weight_multiplier = 1.5 # –ú–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å: 1.2, 1.5, 2.0
    if 0 in class_weight_dict: # BUY
        class_weight_dict[0] *= additional_weight_multiplier
    if 1 in class_weight_dict: # SELL
        class_weight_dict[1] *= additional_weight_multiplier
    # =====================================================================
    # –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê
    # =====================================================================

    print(f"üìä –í–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è: {class_weight_dict}")

    # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ train_xlstm_rl_system) ...



3. –§–∞–π–ª: trading_env.py
–ú—ã –¥–æ–±–∞–≤–∏–º –±–æ–Ω—É—Å –∑–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º—É –Ω–∞–≥—Ä–∞–¥ RL-–∞–≥–µ–Ω—Ç–∞.


–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é _calculate_advanced_reward.


–í –∫–æ–Ω—Ü–µ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –ø–µ—Ä–µ–¥ return total_reward, –¥–æ–±–∞–≤—å—Ç–µ –±–æ–Ω—É—Å –∑–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:
# –í trading_env.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ _calculate_advanced_reward(...):
# ... (–≤–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞—Å—á–µ—Ç–∞ base_reward, vsa_bonus, vsa_penalty –∏ —Ç.–¥.) ...

    # =====================================================================
    # –ù–û–í–´–ô –ë–õ–û–ö: –ë–û–ù–£–° –ó–ê –ò–°–°–õ–ï–î–û–í–ê–ù–ò–ï (Exploration Bonus)
    # =====================================================================
    exploration_bonus = 0
    # –ù–µ–±–æ–ª—å—à–æ–π –±–æ–Ω—É—Å –∑–∞ –ø–æ–ø—ã—Ç–∫—É BUY/SELL, —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç –Ω–µ –∑–∞—Å—Ç—Ä—è–ª –≤ HOLD
    if action in [0, 1]: # –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ - BUY –∏–ª–∏ SELL
        # –ë–æ–Ω—É—Å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø–æ –º–µ—Ä–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —á–∏—Å–ª–∞ –ø–æ–ø—ã—Ç–æ–∫ —ç—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å, —á—Ç–æ–±—ã —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—ã—Ç–∫–∏
        exploration_bonus = 0.5 # –ù–µ–±–æ–ª—å—à–æ–π, –Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –±–æ–Ω—É—Å
    
    # –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –±–æ–Ω—É—Å, –∑–∞–≤–∏—Å—è—â–∏–π –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è
    # –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –±—ã –º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ª–∏, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ
    # –ù–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –Ω–∞—á–Ω–µ–º —Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
    # =====================================================================
    # –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê
    # =====================================================================

    total_reward = base_reward + vsa_bonus + vsa_penalty + speed_bonus + hold_penalty + exploration_bonus # <--- –î–û–ë–ê–í–õ–ï–ù–û: exploration_bonus
    
    return total_reward




–ü–æ—á–µ–º—É —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–º–æ—á—å:

Event-Based Sampling: –ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç –æ–±—É—á–∞—Ç—å—Å—è –Ω–∞ –º–µ–Ω—å—à–µ–º, –Ω–æ –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–º –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "—Å–æ–±—ã—Ç–∏—è". –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç —à—É–º –æ—Ç "—Å–∫—É—á–Ω—ã—Ö" HOLD-–ø–µ—Ä–∏–æ–¥–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏ –ª—É—á—à–µ —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö, –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–∏–º—ã–º –¥–≤–∏–∂–µ–Ω–∏—è–º. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤ BUY/SELL.
–£—Å–∏–ª–µ–Ω–Ω–æ–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –¥–ª—è BUY/SELL –∑–∞—Å—Ç–∞–≤–∏—Ç xLSTM –º–æ–¥–µ–ª—å —É–¥–µ–ª—è—Ç—å —ç—Ç–∏–º –∫–ª–∞—Å—Å–∞–º –µ—â–µ –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ imblearn –Ω–µ —Å–º–æ–≥ –∏–¥–µ–∞–ª—å–Ω–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
RL Exploration Bonus: –≠—Ç–æ—Ç –±–æ–Ω—É—Å –Ω–∞–ø—Ä—è–º—É—é —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç RL-–∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–±–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è BUY/SELL, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –∫–∞–∂—É—Ç—Å—è —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ —Ä–µ–¥–∫–∏–º–∏. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –∞–≥–µ–Ω—Ç—É –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —ç—Ç–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –≤ HOLD.

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ —Å–Ω–æ–≤–∞. –ú—ã –æ–∂–∏–¥–∞–µ–º —É–≤–∏–¥–µ—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤, —Ç–∞–∫ –∫–∞–∫ –º—ã –∞—Ç–∞–∫—É–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–æ—Ä–æ–Ω: –±–æ–ª–µ–µ "—É–º–Ω–∞—è" —Ä–∞–∑–º–µ—Ç–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —É—Å–∏–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–±—É—á–µ–Ω–∏—è.