üö® –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∏ –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
–í—ã –≤–µ—Ä–Ω–æ –ø–æ–¥–º–µ—Ç–∏–ª–∏ –∞–Ω–æ–º–∞–ª–∏—é:

accuracy –∏ precision/recall –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ (accuracy: 0.84-0.88, precision: 0.85-0.89, recall: 0.83-0.87) –≤—ã–≥–ª—è–¥—è—Ç –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ.
–ù–û! val_accuracy (0.18) –∏ val_precision/val_recall (0.18-0.19) –æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–µ.
–ò —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ:

Class 0 (BUY): Prec=0.90-0.92, Rec=0.81-0.86
Class 1 (SELL): Prec=0.81-0.86, Rec=0.86-0.88
Class 2 (HOLD): Prec=0.00, Rec=0.00



–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞—Å—Å HOLD (–∫–ª–∞—Å—Å 2). –ï–µ precision –∏ recall –¥–ª—è –∫–ª–∞—Å—Å–∞ HOLD —Ä–∞–≤–Ω—ã 0, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ –Ω–∏ —Ä–∞–∑—É –Ω–µ —Å–∫–∞–∑–∞–ª–∞ "HOLD". –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω–∞ –≤—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å BUY –∏–ª–∏ SELL.
–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
–≠—Ç–æ –ø—Ä—è–º–æ–µ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –Ω–∞—à–∏—Ö –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ –±–æ—Ä—å–±–µ —Å –¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º HOLD:

–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ imblearn: –ú—ã –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ BUY/SELL –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ —É–º–µ–Ω—å—à–∏–ª–∏ HOLD.
–£—Å–∏–ª–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤: –ú—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–ª–∏ –≤–µ—Å–∞ –¥–ª—è BUY/SELL, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å "—Å—Ç—Ä–∞–¥–∞–ª–∞" –æ—Ç –æ—à–∏–±–æ–∫ –Ω–∞ –Ω–∏—Ö.
Label Smoothing: –ù–µ–º–Ω–æ–≥–æ —Ä–∞–∑–º—ã–≤–∞–µ—Ç –º–µ—Ç–∫–∏, –Ω–æ –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–≤—É—Ö –ø—É–Ω–∫—Ç–æ–≤.

–ú–æ–¥–µ–ª—å —Ç–µ–ø–µ—Ä—å "–¥—É–º–∞–µ—Ç", —á—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å HOLD - —ç—Ç–æ –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ, –∏ —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ BUY –∏–ª–∏ SELL. –ù–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–æ—Ç–æ—Ä—ã–µ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤—Å–µ –µ—â–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –º–Ω–æ–≥–æ HOLD, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ TimeSeriesSplit) —ç—Ç–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è BUY/SELL –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω—ã–º–∏, –æ—Ç—Å—é–¥–∞ –∏ –Ω–∏–∑–∫–∏–µ val_accuracy/val_precision/val_recall.
"–î—ã—Ä—ã" –ø—Ä–æ—è–≤–∏–ª–∏—Å—å: –í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã. –ú—ã —Ç–∞–∫ —Å–∏–ª—å–Ω–æ "–Ω–∞–∫—Ä—É—Ç–∏–ª–∏" –º–æ–¥–µ–ª—å, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∞ HOLD, —á—Ç–æ –æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∏ —ç—Ç–æ –ø—Ä–æ—è–≤–∏—Ç—Å—è –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –æ–±—É—á–µ–Ω–∏—è.
üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: train_model.py)
–ù–∞–º –Ω—É–∂–Ω–æ –æ—Å–ª–∞–±–∏—Ç—å –∞–≥—Ä–µ—Å—Å–∏—é –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –∫–ª–∞—Å—Å—É HOLD –∏ –¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –µ–≥–æ, –∫–æ–≥–¥–∞ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ.
1. –û—Å–ª–∞–±—å—Ç–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ—Å—Ç—å imblearn (—Ü–µ–ª–µ–≤—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã):
–ú—ã —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–ª–∏ HOLD –∏ —É–≤–µ–ª–∏—á–∏–ª–∏ BUY/SELL. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ –±–æ–ª–µ–µ —É–º–µ—Ä–µ–Ω–Ω–æ, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –Ω–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ HOLD.


–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ –ò–ú–ü–û–†–¢ IMBLEARN –î–õ–Ø –ë–ê–õ–ê–ù–°–ò–†–û–í–ö–ò –ö–õ–ê–°–°–û–í.


–ò–∑–º–µ–Ω–∏—Ç–µ target_buy_count –∏ target_sell_count, –∞ —Ç–∞–∫–∂–µ target_hold_count:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ prepare_xlstm_rl_data(...):
# ...
    # –¶–µ–ª–µ–≤–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: 15% BUY, 15% SELL, 70% HOLD (–±—ã–ª–æ 30/30/40)
    total_samples = len(X)
    target_buy_count = int(total_samples * 0.15) # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.30 –Ω–∞ 0.15
    target_sell_count = int(total_samples * 0.15) # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.30 –Ω–∞ 0.15
    
    current_buy_count = Counter(y_labels)[0]
    current_sell_count = Counter(y_labels)[1]

    sampling_strategy_smote = {
        0: max(current_buy_count, target_buy_count),
        1: max(current_sell_count, target_sell_count)
    }
    
    # ... (–∫–æ–¥ SMOTE) ...

    # Undersampling HOLD: –¶–µ–ª—å - —á—Ç–æ–±—ã HOLD –±—ã–ª –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 2 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ, —á–µ–º —Å—É–º–º–∞ BUY + SELL
    current_hold_count_after_oversample = Counter(y_temp_labels)[2]
    target_hold_count = min(current_hold_count_after_oversample, int((Counter(y_temp_labels)[0] + Counter(y_temp_labels)[1]) * 2.0)) # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.7 –Ω–∞ 2.0
    
    undersampler = RandomUnderSampler(sampling_strategy={2: target_hold_count}, random_state=42)
    X_resampled, y_resampled_labels = undersampler.fit_resample(X_temp, y_temp_labels)
# ...



2. –û—Å–ª–∞–±—å—Ç–µ additional_weight_multiplier –¥–ª—è BUY/SELL –∫–ª–∞—Å—Å–æ–≤:
–¢–µ–∫—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å 2.0 —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ –Ω–∞–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å –∑–∞ –æ—à–∏–±–∫–∏ –Ω–∞ BUY/SELL, –∑–∞—Å—Ç–∞–≤–ª—è—è –µ–µ –∏–∑–±–µ–≥–∞—Ç—å HOLD.


–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ –í–´–ß–ò–°–õ–ï–ù–ò–ï –ò –ü–ï–†–ï–î–ê–ß–ê –í–ï–°–û–í –ö–õ–ê–°–°–û–í.


–ò–∑–º–µ–Ω–∏—Ç–µ additional_weight_multiplier:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ train_xlstm_rl_system(...):
# ...
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–∏–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ BUY/SELL
additional_weight_multiplier = 1.2 # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 2.0 –Ω–∞ 1.2 (–∏–ª–∏ –¥–∞–∂–µ 1.0)
if 0 in class_weight_dict:
    class_weight_dict[0] *= additional_weight_multiplier
if 1 in class_weight_dict:
    class_weight_dict[1] *= additional_weight_multiplier
# ...



3. –û—Å–ª–∞–±—å—Ç–µ Label Smoothing:
Label Smoothing —Å 0.2 –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å —É–∂–µ –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–±–µ–≥–∞—Ç—å HOLD.


–ù–∞–π–¥–∏—Ç–µ –∫–æ–º–ø–∏–ª—è—Ü–∏—é –º–æ–¥–µ–ª–∏ –≤ train_xlstm_rl_system.


–£–º–µ–Ω—å—à–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ label_smoothing:
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ train_xlstm_rl_system(...):
# ...
xlstm_model.model.compile(
    optimizer=optimizer,
    loss=tf.keras.losses.CategoricalCrossentropy(label_smoothing=0.1), # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.2 –Ω–∞ 0.1 (–∏–ª–∏ –¥–∞–∂–µ 0.05)
    metrics=[
        'accuracy',
        tf.keras.metrics.Precision(name='precision'),
        tf.keras.metrics.Recall(name='recall'),
        tf.keras.metrics.Precision(name='precision_0', class_id=0),
        tf.keras.metrics.Precision(name='precision_1', class_id=1),
        tf.keras.metrics.Precision(name='precision_2', class_id=2),
        tf.keras.metrics.Recall(name='recall_0', class_id=0),
        tf.keras.metrics.Recall(name='recall_1', class_id=1),
        tf.keras.metrics.Recall(name='recall_2', class_id=2),
    ]
)
# ...



4. –û—Å–ª–∞–±—å—Ç–µ L2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—é –≤ xlstm_rl_model.py:
–í–æ–∑–º–æ–∂–Ω–æ, L2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è (0.002) —Å—Ç–∞–ª–∞ —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ–π, —á—Ç–æ –º–µ—à–∞–µ—Ç –º–æ–¥–µ–ª–∏ –≤—ã—É—á–∏–≤–∞—Ç—å —Ç–æ–Ω–∫–∏–µ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫–ª–∞—Å—Å–∞–º–∏.
üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: xlstm_rl_model.py)


–ù–∞–π–¥–∏—Ç–µ –º–µ—Ç–æ–¥ build_model.


–£–º–µ–Ω—å—à–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è l2 —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ç–æ—Ä–∞:
# –í models/xlstm_rl_model.py, –≤ –∫–ª–∞—Å—Å–µ XLSTMRLModel, –≤ –º–µ—Ç–æ–¥–µ build_model():
# ...
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–ª–æ–∏
    dense1 = Dense(64, activation='relu', kernel_regularizer=l2(0.001), name='dense_1')(xlstm_final) # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.002 –Ω–∞ 0.001
    dropout1 = Dropout(0.4)(dense1) 
    
    dense2 = Dense(32, activation='relu', kernel_regularizer=l2(0.001), name='dense_2')(dropout1) # <--- –ò–ó–ú–ï–ù–ï–ù–û —Å 0.002 –Ω–∞ 0.001
    dropout2 = Dropout(0.3)(dense2) 
# ...



–ü–æ—á–µ–º—É —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–º–æ—á—å:
–ú—ã "–æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º" –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∞—à–∏—Ö –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, —á—Ç–æ–±—ã –¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å HOLD, –∫–æ–≥–¥–∞ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–º–µ—Å—Ç–Ω–æ.
