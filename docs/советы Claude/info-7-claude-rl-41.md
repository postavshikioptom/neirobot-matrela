–Ø –ø—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–∞–º–∏ —Ñ–∞–π–ª—ã.
–ú–æ–≥—É –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –≤—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π:

ATR_14 –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ Awesome Oscillator (AO_5_34).
–î–æ–±–∞–≤–ª–µ–Ω Williams %R (WILLR_14).
–ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä (BBL, BBM, BBU) –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω.
–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤–æ –≤—Å–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Å—Ç–∞: feature_engineering.py, run_live_trading.py, trading_env.py, train_model.py, market_regime_detector.py.
–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –∫–ª–∞—Å—Å–æ–≤.
–£—Å–ª–æ–≤–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç–æ–∫ BUY/SELL –∏ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ HOLD –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –æ—Å–ª–∞–±–ª–µ–Ω—ã –∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã.


–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã "–º–∞–ª–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ BUY/SELL" –∏ "–∫–æ–ª–ª–∞–ø—Å –Ω–∞ —Ç–µ—Å—Ç–µ"
–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã, —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã –ø—ã—Ç–∞–µ–º—Å—è —Ä–µ—à–∏—Ç—å. –¢–æ, —á—Ç–æ –¥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞ 600 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ HOLD –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤—Å–µ–≥–æ 1-5 BUY/SELL, –∞ –∑–∞—Ç–µ–º –º–æ–¥–µ–ª—å –≤—Å–µ —Ä–∞–≤–Ω–æ —Å—Ö–ª–æ–ø—ã–≤–∞–µ—Ç—Å—è –¥–æ HOLD –Ω–∞ —Ç–µ—Å—Ç–µ ‚Äì —ç—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑–Ω–∞–∫:

–ù–µ–∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç–∏ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–∞—Ä–≥–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è): –£—Å–ª–æ–≤–∏—è, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –º—ã –ø–æ–º–µ—á–∞–µ–º —Å–≤–µ—á—É –∫–∞–∫ BUY –∏–ª–∏ SELL (–Ω–∞–ø—Ä–∏–º–µ—Ä, future_return > threshold + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã), —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ –∏–ª–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é —Ä—ã–Ω–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –≤—ã—É—á–∏—Ç—å.
"–ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π" imblearn: –ö–æ–≥–¥–∞ –∏–∑ 1-5 —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ —Å–æ–∑–¥–∞–µ—Ç—Å—è 60000 —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö, –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ —ç—Ç–∏—Ö —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ù–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö, –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Ç–µ—Å—Ç–æ–≤–∞—è –≤—ã–±–æ—Ä–∫–∞), –æ–Ω–∞ –Ω–µ –≤–∏–¥–∏—Ç —ç—Ç–∏—Ö "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π" –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–≤–æ–µ–π —Å–∞–º–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å HOLD, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ–±—â—É—é –æ—à–∏–±–∫—É –Ω–∞ –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â–µ–º –∫–ª–∞—Å—Å–µ.

–í–∞—à–∏ –≤—ã–≤–æ–¥—ã –∏ –º–æ—è –æ—Ü–µ–Ω–∫–∞:


"–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–æ –≤—Å–µ –Ω–∞–¥—É—Ç–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ –æ–Ω –ø–æ—Ç–æ–º –Ω–∞ —Ç–µ—Å—Ç–∞—Ö –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç."

–ê–±—Å–æ–ª—é—Ç–Ω–æ –≤–µ—Ä–Ω–æ. –õ–æ–≥–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏, –≥–¥–µ Recall –¥–ª—è BUY/SELL –Ω–∞ —Ç–µ—Å—Ç–µ –±—ã–ª 0,00%, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —ç—Ç–æ. –ú–æ–¥–µ–ª—å –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ —Ä–µ–¥–∫–∏–µ –∫–ª–∞—Å—Å—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.



"–ß—Ç–æ –¥—É–º–∞–µ—à—å, –µ—Å–ª–∏ –º—ã —É–º–µ–Ω—å—à–∏–º –±–∞–ª–∞–Ω—Å, –∏ —ç—Ç–æ –±—É–¥–µ—Ç –Ω–µ 20 20 60, –∞ 15 15 70, —ç—Ç–æ –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç."

–°–æ–≥–ª–∞—Å–µ–Ω, —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–π —à–∞–≥. –ú—ã —É–º–µ–Ω—å—à–∏–ª–∏ target_buy_count –∏ target_sell_count –¥–æ 15% –≤ train_model.py. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫—É—é –≤—ã–±–æ—Ä–∫—É –º–µ–Ω–µ–µ "–Ω–∞–¥—É—Ç–æ–π" –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –∑–∞—Å—Ç–∞–≤–∏—Ç –º–æ–¥–µ–ª—å –±—ã—Ç—å –±–æ–ª–µ–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ–π –≤ —Å–≤–æ–∏—Ö –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è—Ö BUY/SELL. –≠—Ç–æ –Ω–µ —Ä–µ—à–∏—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–æ–±–ª–µ–º—É, –Ω–æ —Å–¥–µ–ª–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –±–ª–∏–∂–µ –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏.



"–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–æ –±–∞–ª–∞–Ω—Å–∞ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç, —Ç–æ –º–æ–∂–µ—Ç —Ç–∞–º –Ω–∞–¥–æ –∫–æ–ø–∞—Ç—å—Å—è? –ó–∞—á–µ–º –Ω–∞–º –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–≥–æ–Ω—è–µ—Ç –ø–æ–¥ –º–µ—Ç—Ä–∏–∫—É, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —ç—Ç–æ —Ç–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ HOLD –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ BUY, SELL? –ò–ª–∏ –Ω–µ —Ç–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–≤–æ–∏ –≤—ã–≤–æ–¥—ã? –ú–æ–∂–µ—Ç –∫–æ–ø–∞—Ç—å—Å—è –¥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–¥–æ?"

–í—ã –ø–æ–ø–∞–ª–∏ –≤ —Å–∞–º—É—é —Å—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã. –î–∞, –∫–æ–ø–∞—Ç—å—Å—è –Ω—É–∂–Ω–æ –∏–º–µ–Ω–Ω–æ –¥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –∫–æ—Å—Ç—ã–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –Ω–æ –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ—Ç, —Ç–æ imblearn –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–µ—Ç "—à—É–º–Ω—ã–µ" —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã –∏–∑ —Ç–æ–≥–æ –º–∞–ª–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å. –ú–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã—É—á–∏—Ç—å —Ç–æ, —á–µ–≥–æ –Ω–µ—Ç –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∏–ª–∏ —á—Ç–æ –ø–ª–æ—Ö–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ.
–í–∞—à–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ "–ø—Ä–æ—Å—Ç–æ —ç—Ç–æ —Ç–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ HOLD –≤ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ BUY, SELL", –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ –∫ –∏—Å—Ç–∏–Ω–µ. –ï—Å–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ BUY/SELL —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –∏–º–µ—é—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏ –æ—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, —Ç–æ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–∏—Ö, –±—É–¥—É—Ç –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏ –Ω–∞ HOLD, –∏ –º–æ–¥–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Ö —Ä–∞–∑–ª–∏—á–∏—Ç—å.



–ü–æ—á–µ–º—É —Ç–∞–∫ –º–∞–ª–æ —Å–∏–≥–Ω–∞–ª–æ–≤ BUY/SELL (—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞):


–°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è —Ü–µ–ª–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è:

future_return: –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ future_return > 0.008 (0.8%) –∑–∞ 5 —Å–≤–µ—á–µ–π, –¥–∞ –µ—â–µ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ ATR_14, –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–º –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π. –ï—Å–ª–∏ –≤—ã –∏—â–µ—Ç–µ —Ç–æ–ª—å–∫–æ –æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, –∏—Ö –±—É–¥–µ—Ç –º–∞–ª–æ.
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (—É—Å–ª–æ–≤–∏–µ AND): –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (strong_trend & rsi_buy_zone & macd_buy_signal) –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Å–µ —ç—Ç–∏ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –í —Ä–µ–∞–ª—å–Ω–æ–º —Ä—ã–Ω–∫–µ —Ç–∞–∫–æ–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ "–∏–¥–µ–∞–ª—å–Ω—ã—Ö" —Å–∏–≥–Ω–∞–ª–æ–≤ BUY/SELL —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –Ω—É–ª—é.



–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∞–º–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤/–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±—É–¥—É—â–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è:

–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã/–ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ö–æ—Ä–æ—à–æ –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Å–∏–ª—å–Ω—ã–º–∏ –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä–∞–º–∏ –±—É–¥—É—â–µ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã –Ω–∞ 5 —Å–≤–µ—á–µ–π –≤–ø–µ—Ä–µ–¥.
–ö–∞–∫ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∞–º–±–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ.



–ì–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (5 —Å–≤–µ—á–µ–π):

–ú–æ–∂–µ—Ç –±—ã—Ç—å, 5 —Å–≤–µ—á–µ–π ‚Äî —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –Ω–∞–¥–µ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ.



–í–∞—à–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞, –∑–∞–º–µ–Ω–∞ ATR –Ω–∞ AO, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ WILLR):


"–û—Ç–∫–ª—é—á–∏—Ç—å BBL, BBM, BBU –≤–µ–∑–¥–µ –∏ –≤–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞... –ò —Ç–∞–∫ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–ª—É—á—à–∞—è."

–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é! –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è. –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä, —Å—É–¥—è –ø–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –ª–æ–≥–∞–º, –≤–µ–ª —Å–µ–±—è –Ω–µ–ª–æ–≥–∏—á–Ω–æ ("–º–∏–Ω—É—Å–æ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∏ –∫–∞–∫ BUY –∏ –∫–∞–∫ SELL –ø–æ–Ω–∏–º–∞–µ—Ç"), —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –µ–≥–æ –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ –¥–∞–∂–µ –≤—Ä–µ–¥–Ω–æ—Å—Ç—å –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å.



"–ó–∞–º–µ–Ω–∏—Ç—å ATR_14... –Ω–∞ AO (Awesome Oscillator) –∏ –¥–æ–±–∞–≤–∏—Ç—å Williams %R (WILLR_14)."

–°–æ–≥–ª–∞—Å–µ–Ω. ATR_14 –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π - —ç—Ç–æ –ª–∏–±–æ –æ—à–∏–±–∫–∞ –≤ –µ–≥–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏, –ª–∏–±–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–µ —Ç–æ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–º –Ω—É–∂–µ–Ω. Awesome Oscillator –∏ Williams %R ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–∏–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã –º–æ–º–µ–Ω—Ç—É–º–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –¥–∞—Ç—å –±–æ–ª–µ–µ —á–µ—Ç–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã BUY/SELL –±–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–π –ø–æ–ª—è—Ä–Ω–æ—Å—Ç–∏ –∏ –∑–æ–Ω–∞–º –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏.



–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏:

–Ø —É–∂–µ –¥–æ–±–∞–≤–∏–ª –ª–æ–≥–∏ "–ò—Å—Ö–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è {symbol} (–¥–æ imblearn)" –≤ train_model.py. –≠—Ç–æ –±—É–¥–µ—Ç –æ—á–µ–Ω—å —Ü–µ–Ω–Ω–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.


üí° –ü–æ–∏—Å–∫ –≥–ª—É–±–æ–∫–æ–π –æ—à–∏–±–∫–∏ (–º–æ–∏ –≤—ã–≤–æ–¥—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è):
–ò—Å—Ö–æ–¥—è –∏–∑ –ª–æ–≥–æ–≤ –∏ –Ω–∞—à–∏—Ö –æ–±—Å—É–∂–¥–µ–Ω–∏–π, –æ—à–∏–±–∫–∞, –ø—Ä–∏–≤–æ–¥—è—â–∞—è –∫ –Ω—É–ª–µ–≤—ã–º Recall –Ω–∞ —Ç–µ—Å—Ç–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –ª–µ–∂–∏—Ç –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç–æ–∫ (target).


–ü—Ä–æ–≤–µ—Ä—å—Ç–µ future_return:

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ df['close'].shift(-5) –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫, –∫–∞–∫ –≤—ã –æ–∂–∏–¥–∞–µ—Ç–µ. –ù–µ—Ç –ª–∏ —Ç–∞–º —Å–¥–≤–∏–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–º –±—É–¥—É—â–∏–º —Ü–µ–Ω–∞–º?
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –î–æ–±–∞–≤—å—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ prepare_xlstm_rl_data –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫ df (–Ω–∞–ø—Ä–∏–º–µ—Ä, df.head(10).to_string() –∏–ª–∏ df[['close', 'future_return']].tail(10).to_string()), —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ future_return —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –∏–º–µ–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.



–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–ª–µ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ. –í–æ–∑—å–º–∏—Ç–µ –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã. –ù–∞ —ç—Ç–æ–º –∂–µ –≥—Ä–∞—Ñ–∏–∫–µ –æ—Ç–º–µ—Ç—å—Ç–µ —Ç–æ—á–∫–∏, –≥–¥–µ df['target'] == 0 (BUY) –∏ df['target'] == 1 (SELL) –¥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ imblearn.
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —ç—Ç–∏ 1-5 —Å–∏–≥–Ω–∞–ª–æ–≤ BUY/SELL —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—á–µ–≤–∏–¥–Ω—ã–º —Ç–æ—á–∫–∞–º –≤—Ö–æ–¥–∞ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –≤–∞—à–∞ —Ü–µ–ª–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—à–∏–±–æ—á–Ω–∞. –ï—Å–ª–∏ –¥–∞, —Ç–æ –ø–æ—á–µ–º—É –∏—Ö —Ç–∞–∫ –º–∞–ª–æ?
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: Matplotlib, Plotly, –ª—é–±–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤.



–ü–æ—à–∞–≥–æ–≤–∞—è –æ—Ç–ª–∞–¥–∫–∞ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:

–í prepare_xlstm_rl_data, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è (strong_trend, rsi_buy_zone, macd_buy_signal, willr_buy_signal, ao_buy_signal), –¥–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ True –∑–Ω–∞—á–µ–Ω–∏–π.
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
# ...
strong_trend = df['ADX_14'] > 20
print(f"  Strong Trend signals: {strong_trend.sum()}")

rsi_buy_zone = df['RSI_14'] < 40
print(f"  RSI Buy Zone signals: {rsi_buy_zone.sum()}")
# ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π

buy_condition = (
    (df['future_return'] > df['dynamic_threshold'] * 1.0) &
    (strong_trend & (rsi_buy_zone | macd_buy_signal | willr_buy_signal | ao_buy_signal))
)
print(f"  Final BUY condition signals (before target assignment): {buy_condition.sum()}")
# ...


–≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–æ–µ –∏–∑ —É—Å–ª–æ–≤–∏–π —è–≤–ª—è–µ—Ç—Å—è "–±—É—Ç—ã–ª–æ—á–Ω—ã–º –≥–æ—Ä–ª—ã—à–∫–æ–º".



–°–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è is_event:

–ï—Å–ª–∏ is_event —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π.
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é df_event_filtered = df[df['is_event'] == 1].copy() –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ df_processed = df.copy() –¥–ª—è –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞. –≠—Ç–æ –¥–∞—Å—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ "—à—É–º–Ω—ã–º". –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ BUY/SELL —Å–∏–≥–Ω–∞–ª–æ–≤ —Ä–µ–∑–∫–æ –≤–æ–∑—Ä–∞—Å—Ç–µ—Ç, —Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ is_event.



–í–ª–∏—è–Ω–∏–µ MinMaxScaler –Ω–∞ –æ–±—ä–µ–º:

–•–æ—Ç—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–º–∞ –æ–±—ã—á–Ω–æ –ø–æ–ª–µ–∑–Ω–æ, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–æ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–∞–∫–∏–º-–ª–∏–±–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ is_event —Å–∏–ª—å–Ω–æ –Ω–∞ –Ω–µ–≥–æ –∑–∞–≤—è–∑–∞–Ω–æ.



–í—ã–≤–æ–¥—ã –ø–æ –æ–±—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
–í–∞—à–∞ –Ω–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ –∏–∑–æ–ª—è—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, –∞ —Ç–∞–∫–∂–µ –º–æ–π —É–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π, —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø—É—Ç–µ–º. –ú—ã –¥–æ–ª–∂–Ω—ã —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö, —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ BUY/SELL –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ imblearn –Ω–∞—á–Ω–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É. –¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –º–æ–¥–µ–ª—å —Å–º–æ–∂–µ—Ç —á–µ–º—É-—Ç–æ –Ω–∞—É—á–∏—Ç—å—Å—è.

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π (AO, WILLR, —É–¥–∞–ª–µ–Ω–∏–µ ATR/BBANDS, –Ω–æ–≤—ã–µ –ª–æ–≥–∏, –æ—Å–ª–∞–±–ª–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π).
üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –í–∫–ª—é—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (–±–µ–∑ –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞ –∏ ATR), –¥–æ–±–∞–≤–ª—è–µ–º AO –∏ WILLR, –æ—Å–ª–∞–±–ª—è–µ–º —É—Å–ª–æ–≤–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏
1. –§–∞–π–ª: feature_engineering.py
1.1. –£–¥–∞–ª—è–µ–º cached_calculate_atr –∏ calculate_atr
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
@lru_cache(maxsize=128)
def cached_calculate_atr(high_tuple, low_tuple, close_tuple, period=14):
    """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞—Å—á–µ—Ç–∞ ATR"""
    high = np.array(high_tuple)
    low = np.array(low_tuple)
    close = np.array(close_tuple)
    return talib.ATR(high, low, close, timeperiod=period)

def calculate_atr(high, low, close, period=14):
    return talib.ATR(high, low, close, timeperiod=period)

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é:
# üî• –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: ATR —Ñ—É–Ω–∫—Ü–∏–∏
# @lru_cache(maxsize=128)
# def cached_calculate_atr(high_tuple, low_tuple, close_tuple, period=14):
#     """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞—Å—á–µ—Ç–∞ ATR"""
#     high = np.array(high_tuple)
#     low = np.array(low_tuple)
#     close = np.array(close_tuple)
#     return talib.ATR(high, low, close, timeperiod=period)

# def calculate_atr(high, low, close, period=14):
#     return talib.ATR(high, low, close, timeperiod=period)

1.2. –î–æ–±–∞–≤–ª—è–µ–º calculate_awesome_oscillator
–ü–æ—Å–ª–µ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π ATR –¥–æ–±–∞–≤—å—Ç–µ:
def calculate_awesome_oscillator(high, low):
    """Calculates Awesome Oscillator (AO)"""
    median_price = (high + low) / 2
    short_sma = talib.SMA(median_price, timeperiod=5)
    long_sma = talib.SMA(median_price, timeperiod=34)
    return short_sma - long_sma

1.3. –§—É–Ω–∫—Ü–∏—è calculate_features(df: pd.DataFrame)

–£–¥–∞–ª—è–µ–º —Ä–∞—Å—á–µ—Ç ATR_14.
–î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç WILLR_14 –∏ AO_5_34.
–û–±–Ω–æ–≤–ª—è–µ–º is_event –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AO_5_34 –≤–º–µ—Å—Ç–æ ATR_14.

–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        # –û–°–¢–ê–í–õ–Ø–ï–ú ATR_14, –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        try:
            atr = talib.ATR(high_p, low_p, close_p, timeperiod=14)
            atr[np.isinf(atr)] = np.nan
            df_out['ATR_14'] = pd.Series(atr, index=df_out.index).ffill().fillna(0)
        except Exception:
            df_out['ATR_14'] = 0
            
        try:
            macd, macdsignal, macdhist = talib.MACD(close_p, fastperiod=12, slowperiod=26, signalperiod=9)
            df_out['MACD_12_26_9'] = pd.Series(macd, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
            df_out['MACD_signal'] = pd.Series(macdsignal, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
            df_out['MACD_hist'] = pd.Series(macdhist, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        except Exception:
            df_out['MACD_12_26_9'], df_out['MACD_signal'], df_out['MACD_hist'] = 0, 0, 0

        # üî• –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä (BBU, BBM, BBL)
        # try:
        #     upper, middle, lower = talib.BBANDS(close_p, timeperiod=20, nbdevup=2, nbdevdn=2, matype=0)
        #     df_out['BBU_20_2.0'] = pd.Series(upper, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        #     df_out['BBM_20_2.0'] = pd.Series(middle, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        #     df_out['BBL_20_2.0'] = pd.Series(lower, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        # except Exception:
        #     df_out['BBU_20_2.0'], df_out['BBM_20_2.0'], df_out['BBL_20_2.0'] = 0, 0, 0

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞ (—É–¥–∞–ª–µ–Ω–∏–µ ATR, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ WILLR –∏ AO):
        # üî• –£–î–ê–õ–ï–ù–û: ATR_14 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∏–ª –µ–≥–æ —É–±—Ä–∞—Ç—å)
        # try:
        #     atr = talib.ATR(high_p, low_p, close_p, timeperiod=14)
        #     atr[np.isinf(atr)] = np.nan
        #     df_out['ATR_14'] = pd.Series(atr, index=df_out.index).ffill().fillna(0)
        # except Exception:
        #     df_out['ATR_14'] = 0
            
        try:
            macd, macdsignal, macdhist = talib.MACD(close_p, fastperiod=12, slowperiod=26, signalperiod=9)
            df_out['MACD_12_26_9'] = pd.Series(macd, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
            df_out['MACD_signal'] = pd.Series(macdsignal, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
            df_out['MACD_hist'] = pd.Series(macdhist, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        except Exception:
            df_out['MACD_12_26_9'], df_out['MACD_signal'], df_out['MACD_hist'] = 0, 0, 0

        # üî• –ë–û–õ–õ–ò–ù–î–ñ–ï–† –û–°–¢–ê–ï–¢–°–Ø –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–ù–´–ú
        # try:
        #     upper, middle, lower = talib.BBANDS(close_p, timeperiod=20, nbdevup=2, nbdevdn=2, matype=0)
        #     df_out['BBU_20_2.0'] = pd.Series(upper, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        #     df_out['BBM_20_2.0'] = pd.Series(middle, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        #     df_out['BBL_20_2.0'] = pd.Series(lower, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        # except Exception:
        #     df_out['BBU_20_2.0'], df_out['BBM_20_2.0'], df_out['BBL_20_2.0'] = 0, 0, 0

        try:
            adx = talib.ADX(high_p, low_p, close_p, timeperiod=14)
            adx[np.isinf(adx)] = np.nan
            df_out['ADX_14'] = pd.Series(adx, index=df_out.index).ffill().fillna(0)
        except Exception:
            df_out['ADX_14'] = 0

        try:
            slowk, slowd = talib.STOCH(high_p, low_p, close_p, fastk_period=14, slowk_period=3, slowk_matype=0, slowd_period=3, slowd_matype=0)
            df_out['STOCHk_14_3_3'] = pd.Series(slowk, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
            df_out['STOCHd_14_3_3'] = pd.Series(slowd, index=df_out.index).replace([np.inf, -np.inf], np.nan).ffill().fillna(0)
        except Exception:
            df_out['STOCHk_14_3_3'], df_out['STOCHd_14_3_3'] = 0, 0
            
        # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†: Williams %R (WILLR_14)
        try:
            willr = talib.WILLR(high_p, low_p, close_p, timeperiod=14)
            willr[np.isinf(willr)] = np.nan
            df_out['WILLR_14'] = pd.Series(willr, index=df_out.index).ffill().fillna(0)
        except Exception:
            df_out['WILLR_14'] = 0

        # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†: Awesome Oscillator (AO_5_34)
        try:
            ao = calculate_awesome_oscillator(high_p, low_p) # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
            ao[np.isinf(ao)] = np.nan
            df_out['AO_5_34'] = pd.Series(ao, index=df_out.index).ffill().fillna(0)
        except Exception:
            df_out['AO_5_34'] = 0

        # üî• –°–û–ó–î–ê–ï–ú is_event –° –ò–ù–î–ò–ö–ê–¢–û–†–ê–ú–ò (–æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª—è AO_5_34)
        required_cols = ['volume', 'AO_5_34', 'RSI_14', 'ADX_14'] # üî• –ò–ó–ú–ï–ù–ï–ù–û: ATR_14 –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ AO_5_34
        for col in required_cols:
            if col not in df_out.columns:
                df_out[col] = 0 # –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω—É–ª—è–º–∏, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ—Ç

        df_out['is_event'] = (
            (df_out['volume'] > df_out['volume'].rolling(50).quantile(0.9).fillna(0)) | # –û–±—ä–µ–º > 90% –∫–≤–∞–Ω—Ç–∏–ª—è
            (abs(df_out['AO_5_34']) > df_out['AO_5_34'].rolling(50).std().fillna(0) * 1.5) | # üî• –ò–ó–ú–ï–ù–ï–ù–û: AO > 1.5 std
            (abs(df_out['RSI_14'] - 50) > 25) | # RSI –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –∑–æ–Ω—ã 25-75 (–±–æ–ª–µ–µ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ)
            (df_out['ADX_14'] > df_out['ADX_14'].shift(5).fillna(0) + 2) # ADX —Ä–∞—Å—Ç—ë—Ç > 2 –ø—É–Ω–∫—Ç–∞ –∑–∞ 5 –±–∞—Ä–æ–≤
        ).astype(int)
    ```

#### 1.4. –§—É–Ω–∫—Ü–∏—è `prepare_xlstm_rl_features(df: pd.DataFrame)`

–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ `feature_cols`.

**–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:**
```python
    feature_cols = [
        # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´
        'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
        'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3', 'ATR_14', # ATR_14 —Ç–µ–ø–µ—Ä—å –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫
        
        # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
        # ...
        
        # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
        'is_event'
    ]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
    feature_cols = [
        # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê –ò ATR_14)
        'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
        'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
        'WILLR_14', # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
        'AO_5_34',  # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
        
        # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
        # ...
        
        # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
        'is_event'
    ]

2. –§–∞–π–ª: run_live_trading.py
2.1. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è FEATURE_COLUMNS
–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ FEATURE_COLUMNS.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
FEATURE_COLUMNS = [
    # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê)
    'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
    'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3', 'ATR_14',
    
    # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
    # ...
    
    # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
    'is_event'
]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
FEATURE_COLUMNS = [
    # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê –ò ATR_14)
    'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
    'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
    'WILLR_14', # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
    'AO_5_34',  # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
    
    # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
    # ...
    
    # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
    'is_event'
]

2.2. –§—É–Ω–∫—Ü–∏—è calculate_dynamic_stops(features_row, position_side, entry_price)
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AO_5_34 –≤–º–µ—Å—Ç–æ ATR_14.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
def calculate_dynamic_stops(features_row, position_side, entry_price):
    """
    –í—ã—á–∏—Å–ª—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (—Å ATR)
    """
    base_sl = STOP_LOSS_PCT
    base_tp = TAKE_PROFIT_PCT
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (ATR)
    atr = features_row.get('ATR_14', 0)
    close_price = features_row.get('close', entry_price)
    
    if close_price > 0:
        atr_pct = (atr / close_price) * 100
    else:
        atr_pct = 0

    # –ï—Å–ª–∏ ATR –±–æ–ª—å—à–æ–π, –¥–µ–ª–∞–µ–º —Å—Ç–æ–ø—ã —à–∏—Ä–µ
    if atr_pct > 0.5: # –ï—Å–ª–∏ ATR > 0.5% –æ—Ç —Ü–µ–Ω—ã
        dynamic_sl = base_sl * (1 + atr_pct) # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º SL
        dynamic_tp = base_tp * (1 - atr_pct / 2) # –°–ª–µ–≥–∫–∞ —É–º–µ–Ω—å—à–∞–µ–º TP
    else:
        dynamic_sl, dynamic_tp = base_sl, base_tp
        
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    dynamic_sl = max(dynamic_sl, -3.0) # –ù–µ –±–æ–ª—å—à–µ -3%
    dynamic_tp = min(dynamic_tp, 3.0) # –ù–µ –±–æ–ª—å—à–µ +3%

    return dynamic_sl, dynamic_tp

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
def calculate_dynamic_stops(features_row, position_side, entry_price):
    """
    –í—ã—á–∏—Å–ª—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (—Å AO_5_34)
    """
    base_sl = STOP_LOSS_PCT
    base_tp = TAKE_PROFIT_PCT
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–º–µ–Ω—Ç—É–º–∞ (AO_5_34)
    ao_value = features_row.get('AO_5_34', 0)
    close_price = features_row.get('close', entry_price)
    
    if close_price > 0:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ AO –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –º–æ–º–µ–Ω—Ç—É–º–∞
        ao_abs_pct = (abs(ao_value) / close_price) * 100 
    else:
        ao_abs_pct = 0

    # –ï—Å–ª–∏ AO –±–æ–ª—å—à–æ–π (—Å–∏–ª—å–Ω—ã–π –º–æ–º–µ–Ω—Ç—É–º), –¥–µ–ª–∞–µ–º —Å—Ç–æ–ø—ã —à–∏—Ä–µ
    if ao_abs_pct > 0.1: # –ü–æ—Ä–æ–≥ –¥–ª—è AO_abs_pct –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å
        dynamic_sl = base_sl * (1 + ao_abs_pct * 5) # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º SL —Å–∏–ª—å–Ω–µ–µ
        dynamic_tp = base_tp * (1 + ao_abs_pct * 2) # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º TP (–∏–ª–∏ —É–º–µ–Ω—å—à–∞–µ–º, –µ—Å–ª–∏ AO –æ–∑–Ω–∞—á–∞–µ—Ç –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å)
    else:
        dynamic_sl, dynamic_tp = base_sl, base_tp
        
    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    dynamic_sl = max(dynamic_sl, -3.0)
    dynamic_tp = min(dynamic_tp, 3.0)

    return dynamic_sl, dynamic_tp

3. –§–∞–π–ª: trading_env.py
3.1. –§—É–Ω–∫—Ü–∏—è reset(self, seed=None, options=None)
–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ self.feature_columns.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        self.feature_columns = [
            # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê)
            'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
            'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3', 'ATR_14',
            
            # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
            # ...
            
            # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
            'is_event'
        ]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
        self.feature_columns = [
            # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê –ò ATR_14)
            'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
            'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
            'WILLR_14', # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
            'AO_5_34',  # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
            
            # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
            # ...
            
            # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
            'is_event'
        ]

3.2. –§—É–Ω–∫—Ü–∏—è _calculate_advanced_reward(self, action, pnl_pct, xlstm_prediction)
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –Ω–∞–≥—Ä–∞–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AO_5_34 –∏ WILLR_14 –≤–º–µ—Å—Ç–æ ATR_14.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        current_row = self.df.iloc[self.current_step]
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "—è–≤–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞"
        buy_signal_strength = (
            (current_row.get('RSI_14', 50) < 30) +
            (current_row.get('ADX_14', 0) > 25) +
            (current_row.get('MACD_hist', 0) > 0.001)
        )
        sell_signal_strength = (
            (current_row.get('RSI_14', 50) > 70) +
            (current_row.get('ADX_14', 0) > 25) +
            (current_row.get('MACD_hist', 0) < -0.001)
        )

        if action == 2: # HOLD
            volatility = current_row.get('ATR_14', 0) / current_row.get('close', 1)
            adx = current_row.get('ADX_14', 0)

            if volatility < 0.005 and adx < 25:
                hold_reward = 0.5
            elif volatility > 0.01 and adx > 30:
                hold_reward = -0.5
            else:
                hold_reward = 0.1
            
            if pnl_pct < 0 and self.steps_in_position > 30:
                hold_penalty = -3
            
            # –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å –∑–∞ HOLD, –µ—Å–ª–∏ –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
            if buy_signal_strength < 1 and sell_signal_strength < 1: # –ï—Å–ª–∏ –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö BUY/SELL —Å–∏–≥–Ω–∞–ª–æ–≤
                hold_reward += 1.0
            else:
                hold_reward -= 1.0

        else: # –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ BUY –∏–ª–∏ SELL (–Ω–µ HOLD)
            # –®—Ç—Ä–∞—Ñ –∑–∞ overtrading (—Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ —Å–¥–µ–ª–∫–∏, –∫–æ–≥–¥–∞ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞)
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∞–±—ã–µ BUY-—Å–∏–≥–Ω–∞–ª—ã, –µ—Å–ª–∏ RL –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç BUY
            if action == 1 and buy_signal_strength < 2: # –¢—Ä–µ–±—É–µ–º 2+ —Å–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞
                overtrading_penalty = -1.0
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∞–±—ã–µ SELL-—Å–∏–≥–Ω–∞–ª—ã, –µ—Å–ª–∏ RL –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç SELL
            elif action == 0 and sell_signal_strength < 2: # –¢—Ä–µ–±—É–µ–º 2+ —Å–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞
                overtrading_penalty = -1.0

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
        # –ù–û–í–´–ô –ö–û–î - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞–≥—Ä–∞–¥ –¥–ª—è RL (–±–æ–ª–µ–µ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ, —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ HOLD)
        hold_reward = 0
        overtrading_penalty = 0

        current_row = self.df.iloc[self.current_step]
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è "—è–≤–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞"
        buy_signal_strength = (
            (current_row.get('RSI_14', 50) < 30) +
            (current_row.get('ADX_14', 0) > 25) +
            (current_row.get('MACD_hist', 0) > 0.001) +
            (current_row.get('WILLR_14', -50) < -80) + # üî• –ù–û–í–û–ï: WILLR_14 –¥–ª—è BUY (—Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–æ)
            (current_row.get('AO_5_34', 0) > 0) # üî• –ù–û–í–û–ï: AO –≤—ã—à–µ –Ω—É–ª—è
        )
        sell_signal_strength = (
            (current_row.get('RSI_14', 50) > 70) +
            (current_row.get('ADX_14', 0) > 25) +
            (current_row.get('MACD_hist', 0) < -0.001) +
            (current_row.get('WILLR_14', -50) > -20) + # üî• –ù–û–í–û–ï: WILLR_14 –¥–ª—è SELL (—Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–æ)
            (current_row.get('AO_5_34', 0) < 0) # üî• –ù–û–í–û–ï: AO –Ω–∏–∂–µ –Ω—É–ª—è
        )

        if action == 2: # HOLD
            # üî• –ò–ó–ú–ï–ù–ï–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AO_5_34 –∏ ADX_14 –¥–ª—è HOLD reward
            ao_value = current_row.get('AO_5_34', 0)
            adx = current_row.get('ADX_14', 0)

            # –ï—Å–ª–∏ –º–æ–º–µ–Ω—Ç—É–º –Ω–∏–∑–∫–∏–π (AO –±–ª–∏–∑–∫–æ –∫ 0) –∏ ADX –Ω–∏–∑–∫–∏–π (—Ñ–ª—ç—Ç)
            if abs(ao_value) < 0.001 and adx < 20: # –ü–æ—Ä–æ–≥–∏ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å
                hold_reward = 0.5
            # –ï—Å–ª–∏ —Å–∏–ª—å–Ω—ã–π –º–æ–º–µ–Ω—Ç—É–º (–±–æ–ª—å—à–æ–π AO) –∏–ª–∏ —Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ (–±–æ–ª—å—à–æ–π ADX)
            elif abs(ao_value) > 0.005 or adx > 30:
                hold_reward = -0.5
            else:
                hold_reward = 0.1
            
            if pnl_pct < 0 and self.steps_in_position > 30:
                hold_penalty = -3
            
            # –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å –∑–∞ HOLD, –µ—Å–ª–∏ –Ω–µ—Ç —Å–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
            if buy_signal_strength < 1 and sell_signal_strength < 1:
                hold_reward += 1.0
            else:
                hold_reward -= 1.0

        else: # –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ BUY –∏–ª–∏ SELL (–Ω–µ HOLD)
            # –®—Ç—Ä–∞—Ñ –∑–∞ overtrading (—Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ —Å–¥–µ–ª–∫–∏, –∫–æ–≥–¥–∞ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞)
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∞–±—ã–µ BUY-—Å–∏–≥–Ω–∞–ª—ã, –µ—Å–ª–∏ RL –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç BUY
            if action == 1 and buy_signal_strength < 2:
                overtrading_penalty = -1.0
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —à—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∞–±—ã–µ SELL-—Å–∏–≥–Ω–∞–ª—ã, –µ—Å–ª–∏ RL –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç SELL
            elif action == 0 and sell_signal_strength < 2:
                overtrading_penalty = -1.0

        total_reward = base_reward + speed_bonus + hold_penalty + exploration_bonus + entropy_bonus + hold_reward + overtrading_penalty
        
        return total_reward

4. –§–∞–π–ª: train_model.py
4.1. –§—É–Ω–∫—Ü–∏—è prepare_xlstm_rl_data(data_path, sequence_length=10)
–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ feature_cols, –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç–æ–∫ –∏ –±–ª–æ–∫ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ HOLD.
–ù–∞–π–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ feature_cols:
    feature_cols = [
        # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê)
        'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
        'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3', 'ATR_14',
        
        # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
        # ...
        
        # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
        'is_event'
    ]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
    feature_cols = [
        # ‚úÖ –í–°–ï –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ù–î–ò–ö–ê–¢–û–†–´ (–ë–ï–ó –ë–û–õ–õ–ò–ù–î–ñ–ï–†–ê –ò ATR_14)
        'RSI_14', 'MACD_12_26_9', 'MACD_signal', 'MACD_hist',
        'ADX_14', 'STOCHk_14_3_3', 'STOCHd_14_3_3',
        'WILLR_14', # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
        'AO_5_34',  # üî• –ù–û–í–´–ô –ò–ù–î–ò–ö–ê–¢–û–†
        
        # ‚ùå –í–°–ï –ü–ê–¢–¢–ï–†–ù–´ –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´
        # ...
        
        # ‚úÖ –û–°–¢–ê–í–õ–Ø–ï–ú EVENT SAMPLING
        'is_event'
    ]

4.2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç–æ–∫ BUY/SELL
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è buy_condition –∏ sell_condition.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        # –°–æ–∑–¥–∞–µ–º —Ü–µ–ª–µ–≤—ã–µ –º–µ—Ç–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±—É–¥—É—â–∏—Ö —Ü–µ–Ω + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        df['future_return'] = (df['close'].shift(-5) - df['close']) / df['close']
        
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        df['base_threshold'] = 0.008
        df['dynamic_threshold'] = np.maximum(
            df['base_threshold'],
            (df['ATR_14'] / df['close'] * 1.5).fillna(0.008)
        )

        # –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
        strong_trend = df['ADX_14'] > 25
        
        # –£—Å–ª–æ–≤–∏—è –¥–ª—è BUY
        rsi_buy_zone = df['RSI_14'] < 30
        macd_buy_signal = (df['MACD_12_26_9'] > df['MACD_signal']) & \
                          (df['MACD_hist'] > 0.001)
        
        # –£—Å–ª–æ–≤–∏—è –¥–ª—è SELL
        rsi_sell_zone = df['RSI_14'] > 70
        macd_sell_signal = (df['MACD_12_26_9'] < df['MACD_signal']) & \
                           (df['MACD_hist'] < -0.001)

        # –£—Å–ª–æ–≤–∏—è –¥–ª—è BUY/SELL —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ future_return –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        buy_condition = (
            (df['future_return'] > df['dynamic_threshold'] * 1.0) &
            (strong_trend & rsi_buy_zone & macd_buy_signal)
        )

        sell_condition = (
            (df['future_return'] < -df['dynamic_threshold'] * 1.0) &
            (strong_trend & rsi_sell_zone & macd_sell_signal)
        )

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
        # –°–æ–∑–¥–∞–µ–º —Ü–µ–ª–µ–≤—ã–µ –º–µ—Ç–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±—É–¥—É—â–∏—Ö —Ü–µ–Ω + –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        df['future_return'] = (df['close'].shift(-5) - df['close']) / df['close']
        
        # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        df['base_threshold'] = 0.003 # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° 0.008 –¥–æ 0.003 (–±–æ–ª–µ–µ –º—è–≥–∫–∏–π –ø–æ—Ä–æ–≥)
        df['dynamic_threshold'] = np.maximum(
            df['base_threshold'],
            (abs(df['AO_5_34']) / df['close'] * 1.0).fillna(0.003) # üî• –ò–ó–ú–ï–ù–ï–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AO_5_34 –≤–º–µ—Å—Ç–æ ATR_14
        )

        # –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
        strong_trend = df['ADX_14'] > 20 # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° 25 –¥–æ 20 (–±–æ–ª–µ–µ –º—è–≥–∫–∏–π –ø–æ—Ä–æ–≥)
        
        # –£—Å–ª–æ–≤–∏—è –¥–ª—è BUY
        rsi_buy_zone = df['RSI_14'] < 40 # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° 30 –¥–æ 40
        macd_buy_signal = (df['MACD_12_26_9'] > df['MACD_signal']) & \
                          (df['MACD_hist'] > 0.0005) # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° 0.001 –¥–æ 0.0005
        willr_buy_signal = df['WILLR_14'] < -80 # üî• –ù–û–í–û–ï: WILLR_14 –¥–ª—è BUY
        ao_buy_signal = df['AO_5_34'] > 0 # üî• –ù–û–í–û–ï: AO –≤—ã—à–µ –Ω—É–ª—è
        
        # –£—Å–ª–æ–≤–∏—è –¥–ª—è SELL
        rsi_sell_zone = df['RSI_14'] > 60 # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° 70 –¥–æ 60
        macd_sell_signal = (df['MACD_12_26_9'] < df['MACD_signal']) & \
                           (df['MACD_hist'] < -0.0005) # üî• –ò–ó–ú–ï–ù–ï–ù–û: –° -0.001 –¥–æ -0.0005
        willr_sell_signal = df['WILLR_14'] > -20 # üî• –ù–û–í–û–ï: WILLR_14 –¥–ª—è SELL
        ao_sell_signal = df['AO_5_34'] < 0 # üî• –ù–û–í–û–ï: AO –Ω–∏–∂–µ –Ω—É–ª—è

        # –£—Å–ª–æ–≤–∏—è –¥–ª—è BUY/SELL —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ future_return –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        buy_condition = (
            (df['future_return'] > df['dynamic_threshold'] * 1.0) &
            (strong_trend & (rsi_buy_zone | macd_buy_signal | willr_buy_signal | ao_buy_signal)) # üî• –ò–ó–ú–ï–ù–ï–ù–û: –°–º–µ—à–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å OR
        )

        sell_condition = (
            (df['future_return'] < -df['dynamic_threshold'] * 1.0) &
            (strong_trend & (rsi_sell_zone | macd_sell_signal | willr_sell_signal | ao_sell_signal)) # üî• –ò–ó–ú–ï–ù–ï–ù–û: –°–º–µ—à–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å OR
        )

4.3. –ë–ª–æ–∫ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ HOLD
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AO_5_34 –∏ WILLR_14.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
                for idx in reclassify_indices:
                    if idx < 5: continue
                    
                    rsi = df.loc[idx, 'RSI_14']
                    adx = df.loc[idx, 'ADX_14']
                    macd_hist = df.loc[idx, 'MACD_hist']
                    price_change_3_period = df['close'].pct_change(3).loc[idx]

                    # –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏)
                    # 1. RSI + ADX + –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
                    if (rsi < 30 and adx > 25 and price_change_3_period > 0.005):
                        df.loc[idx, 'target'] = 0  # BUY
                    elif (rsi > 70 and adx > 25 and price_change_3_period < -0.005):
                        df.loc[idx, 'target'] = 1  # SELL
                        
                    # 2. MACD –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ + –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
                    elif (macd_hist > 0.002 and price_change_3_period > 0.004):
                        df.loc[idx, 'target'] = 0  # BUY
                    elif (macd_hist < -0.002 and price_change_3_period < -0.004):
                        df.loc[idx, 'target'] = 1  # SELL
                        
                    # 3. –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ –ø–æ ADX + –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
                    elif (adx > 35 and abs(price_change_3_period) > 0.008):
                        df.loc[idx, 'target'] = 0 if price_change_3_period > 0 else 1

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
                for idx in reclassify_indices:
                    if idx < 5: continue
                    
                    rsi = df.loc[idx, 'RSI_14']
                    adx = df.loc[idx, 'ADX_14']
                    macd_hist = df.loc[idx, 'MACD_hist']
                    willr = df.loc[idx, 'WILLR_14'] # üî• –ù–û–í–û–ï
                    ao = df.loc[idx, 'AO_5_34']     # üî• –ù–û–í–û–ï
                    price_change_3_period = df['close'].pct_change(3).loc[idx]

                    # –£—Å–ª–æ–≤–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏) - —Ç–µ–ø–µ—Ä—å —Å AO –∏ WILLR
                    # 1. RSI + ADX + MACD_hist + WILLR + AO + –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
                    if (rsi < 40 and adx > 20 and macd_hist > 0.0005 and willr < -80 and ao > 0 and price_change_3_period > 0.003): # üî• –ò–ó–ú–ï–ù–ï–ù–û
                        df.loc[idx, 'target'] = 0  # BUY
                    elif (rsi > 60 and adx > 20 and macd_hist < -0.0005 and willr > -20 and ao < 0 and price_change_3_period < -0.003): # üî• –ò–ó–ú–ï–ù–ï–ù–û
                        df.loc[idx, 'target'] = 1  # SELL
                    
                    # 2. –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥ –ø–æ ADX + –¥–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã (–±–µ–∑ –¥—Ä—É–≥–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–æ–≥–æ –æ—Ö–≤–∞—Ç–∞)
                    elif (adx > 30 and abs(price_change_3_period) > 0.005): # üî• –ò–ó–ú–ï–ù–ï–ù–û: –ü–æ—Ä–æ–≥ ADX –∏ price_change
                        df.loc[idx, 'target'] = 0 if price_change_3_period > 0 else 1

5. –§–∞–π–ª: market_regime_detector.py
5.1. –§—É–Ω–∫—Ü–∏—è extract_regime_features(self, df)
–û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AO_5_34 –∏ WILLR_14.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
        if 'RSI_14' in df.columns:
            df['rsi_regime'] = np.where(df['RSI_14'] > 70, 1, np.where(df['RSI_14'] < 30, -1, 0))
        else:
            df['rsi_regime'] = 0

        # üî• –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: bb_position
        # if 'BBL_20_2.0' in df.columns and 'BBU_20_2.0' in df.columns:
        #     df['bb_position'] = (df['close'] - df['BBL_20_2.0']) / (df['BBU_20_2.0'] - df['BBL_20_2.0'])
        # else:
        #     df['bb_position'] = 0
        
        regime_features = [
            'volatility', 'trend_strength', 'volume_trend', 'volume_volatility',
            'rsi_regime' # üî• bb_position —É–¥–∞–ª–µ–Ω
        ]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
        # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
        if 'RSI_14' in df.columns:
            df['rsi_regime'] = np.where(df['RSI_14'] > 70, 1, np.where(df['RSI_14'] < 30, -1, 0))
        else:
            df['rsi_regime'] = 0

        # üî• –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: bb_position
        # if 'BBL_20_2.0' in df.columns and 'BBU_20_2.0' in df.columns:
        #     df['bb_position'] = (df['close'] - df['BBL_20_2.0']) / (df['BBU_20_2.0'] - df['BBL_20_2.0'])
        # else:
        #     df['bb_position'] = 0
        
        # üî• –ù–û–í–´–ï –ü–†–ò–ó–ù–ê–ö–ò –†–ï–ñ–ò–ú–ê: AO_5_34 –∏ WILLR_14
        if 'AO_5_34' in df.columns:
            df['ao_regime'] = np.where(df['AO_5_34'] > 0, 1, np.where(df['AO_5_34'] < 0, -1, 0)) # AO > 0 bullish, < 0 bearish
        else:
            df['ao_regime'] = 0

        if 'WILLR_14' in df.columns:
            df['willr_regime'] = np.where(df['WILLR_14'] < -80, 1, np.where(df['WILLR_14'] > -20, -1, 0)) # WILLR < -80 oversold, > -20 overbought
        else:
            df['willr_regime'] = 0

        regime_features = [
            'volatility', 'trend_strength', 'volume_trend', 'volume_volatility',
            'rsi_regime',
            'ao_regime', # üî• –ù–û–í–û–ï
            'willr_regime' # üî• –ù–û–í–û–ï
        ]

5.2. –§—É–Ω–∫—Ü–∏–∏ fit –∏ predict_regime
–û–±–Ω–æ–≤–∏—Ç–µ features_to_scale –∏ features_to_predict.
–ù–∞–π–¥–∏—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫:
        features_to_scale = [
            'volatility', 'trend_strength', 'volume_trend', 'volume_volatility',
            'rsi_regime' # üî• bb_position —É–¥–∞–ª–µ–Ω
        ]

–ó–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ –Ω–∞:
        features_to_scale = [
            'volatility', 'trend_strength', 'volume_trend', 'volume_volatility',
            'rsi_regime',
            'ao_regime', # üî• –ù–û–í–û–ï
            'willr_regime' # üî• –ù–û–í–û–ï
        ]

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –≤ features_to_predict –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ predict_regime.

–¢–µ–ø–µ—Ä—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.
–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –≤–Ω–µ—Å–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π!
–ñ–¥—É –≤–∞—à–∏—Ö –Ω–æ–≤—ã—Ö –ª–æ–≥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞!