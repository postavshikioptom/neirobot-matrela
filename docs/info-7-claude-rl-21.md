

‚ùå –ß–¢–û –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (–ö–†–ò–¢–ò–ß–ù–û):
1. –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ù–ï –ò–ó–ú–ï–ù–ï–ù–´ –£–°–õ–û–í–ò–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò –ú–ï–¢–û–ö
–í train_model.py –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–´ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
‚ùå –ù–ï –ò–ó–ú–ï–ù–ï–ù–û:
# –°–¢–ê–†–´–ô –ö–û–î (–≤—Å–µ –µ—â–µ –≤ —Ñ–∞–π–ª–µ):
df['vsa_buy_score'] = (
    0.3 * (df['vsa_no_supply'] == 1) +
    0.3 * (df['vsa_stopping_volume'] == 1) +
    0.4 * (df['vsa_strength'] > 0.1)  # –°–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–µ —É—Å–ª–æ–≤–∏—è
)

buy_condition = (
    (df['future_return'] > df['dynamic_future_threshold']) &
    (df['vsa_buy_score'] > 0.2)  # –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥
)

2. ‚ùå –ù–ï –ò–ó–ú–ï–ù–ï–ù–´ –í–ï–°–ê –ö–õ–ê–°–°–û–í
‚ùå –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:
# –°–¢–ê–†–´–ô –ö–û–î (–≤—Å–µ –µ—â–µ –≤ —Ñ–∞–π–ª–µ):
additional_weight_multiplier = 1.0  # –ù–µ –∏–∑–º–µ–Ω–µ–Ω
# –ù–ï–¢ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≤–µ—Å–∞ HOLD –∫–ª–∞—Å—Å–∞

3. ‚ùå –ù–ï –ò–ó–ú–ï–ù–ï–ù–ê –ü–ï–†–ï–ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Ø
–ë–ª–æ–∫ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ HOLD –Ω–µ –∏–∑–º–µ–Ω–µ–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º.
üö® –°–†–û–ß–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
–§–∞–π–ª: train_model.py - —Å—Ç—Ä–æ–∫–∞ ~180
–ó–ê–ú–ï–ù–ò–¢–¨:
# –ù–û–í–´–ô –ö–û–î - –ë–û–õ–ï–ï –°–¢–†–û–ì–ò–ï –£–°–õ–û–í–ò–Ø –î–õ–Ø BUY/SELL
# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
df['base_threshold'] = 0.008  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å 0.0005 –¥–æ 0.008 (0.8%)
df['dynamic_threshold'] = np.maximum(
    df['base_threshold'],
    (df['ATR_14'] / df['close'] * 1.2).fillna(0.008)  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å
)

# –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ VSA —É—Å–ª–æ–≤–∏—è
df['vsa_buy_strength'] = (
    0.5 * (df['vsa_no_supply'] == 1) +
    0.5 * (df['vsa_stopping_volume'] == 1) +
    0.3 * np.clip(df['vsa_strength'] / 2.0, 0, 1)  # –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
)

df['vsa_sell_strength'] = (
    0.5 * (df['vsa_no_demand'] == 1) +
    0.5 * (df['vsa_climactic_volume'] == 1) +
    0.3 * np.clip(-df['vsa_strength'] / 2.0, 0, 1)
)

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
strong_trend = df['ADX_14'] > 25
high_volume = df['volume_ratio'] > 1.5
rsi_extreme_buy = df['RSI_14'] < 30
rsi_extreme_sell = df['RSI_14'] > 70

# –ë–û–õ–ï–ï –°–¢–†–û–ì–ò–ï —É—Å–ª–æ–≤–∏—è –¥–ª—è BUY/SELL
buy_condition = (
    (df['future_return'] > df['dynamic_threshold']) &
    (df['vsa_buy_strength'] > 0.6) &  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ —Å 0.2 –¥–æ 0.6
    (strong_trend | high_volume | rsi_extreme_buy)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
)

sell_condition = (
    (df['future_return'] < -df['dynamic_threshold']) &
    (df['vsa_sell_strength'] > 0.6) &  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ —Å 0.2 –¥–æ 0.6
    (strong_trend | high_volume | rsi_extreme_sell)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
)

–§–∞–π–ª: train_model.py - —Å—Ç—Ä–æ–∫–∞ ~350
–ó–ê–ú–ï–ù–ò–¢–¨:
# –ù–û–í–´–ô –ö–û–î - –ë–ê–õ–ê–ù–°–ò–†–£–ï–ú –í–ï–°–ê –ü–†–ê–í–ò–õ–¨–ù–û
# –ü—Ä–æ–±–ª–µ–º–∞: HOLD –∏–º–µ–µ—Ç —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π recall, –Ω—É–∂–Ω–æ –£–í–ï–õ–ò–ß–ò–¢–¨ –µ–≥–æ –≤–µ—Å

# –£–º–µ–Ω—å—à–∞–µ–º –≤–µ—Å–∞ BUY/SELL (–æ–Ω–∏ —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ)
weight_reduction_factor = 0.6  # –£–º–µ–Ω—å—à–∞–µ–º –≤–µ—Å–∞ BUY/SELL
if 0 in class_weight_dict:
    class_weight_dict[0] *= weight_reduction_factor
if 1 in class_weight_dict:
    class_weight_dict[1] *= weight_reduction_factor

# –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –≤–µ—Å HOLD (—á—Ç–æ–±—ã –º–æ–¥–µ–ª—å —á–∞—â–µ –µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–ª–∞)
hold_boost_factor = 1.8  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å HOLD
if 2 in class_weight_dict:
    class_weight_dict[2] *= hold_boost_factor

print(f"üìä –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –≤–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤: {class_weight_dict}")

–§–∞–π–ª: train_model.py - —Å—Ç—Ä–æ–∫–∞ ~220
–ó–ê–ú–ï–ù–ò–¢–¨ –±–ª–æ–∫ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:
# –ù–û–í–´–ô –ö–û–î - –£–ú–ï–ù–¨–®–ê–ï–ú –ü–ï–†–ï–ö–õ–ê–°–°–ò–§–ò–ö–ê–¶–ò–Æ
# –¢–µ–ø–µ—Ä—å –ù–ï –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º, –µ—Å–ª–∏ HOLD —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ–Ω—å—à–µ 70%
if current_hold_count < (current_buy_count + current_sell_count) * 2.0:  # –ï—Å–ª–∏ HOLD < 66%
    print(f"‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–∞–ª–æ HOLD —Å–∏–≥–Ω–∞–ª–æ–≤. –î–û–ë–ê–í–õ–Ø–ï–ú HOLD –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.")
    
    # –í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ HOLD –≤ BUY/SELL, –¥–µ–ª–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ–µ
    # –ü–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º —á–∞—Å—Ç—å —Å–ª–∞–±—ã—Ö BUY/SELL –≤ HOLD
    
    weak_buy_indices = df[
        (df['target'] == 0) & 
        (df['vsa_buy_strength'] < 0.4) &  # –°–ª–∞–±—ã–µ VSA —Å–∏–≥–Ω–∞–ª—ã
        (df['RSI_14'] > 35) & (df['RSI_14'] < 65)  # RSI –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –∑–æ–Ω–µ
    ].index
    
    weak_sell_indices = df[
        (df['target'] == 1) & 
        (df['vsa_sell_strength'] < 0.4) &  # –°–ª–∞–±—ã–µ VSA —Å–∏–≥–Ω–∞–ª—ã
        (df['RSI_14'] > 35) & (df['RSI_14'] < 65)  # RSI –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –∑–æ–Ω–µ
    ].index
    
    # –ü–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º 30% —Å–ª–∞–±—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ HOLD
    import random
    random.seed(42)
    
    if len(weak_buy_indices) > 0:
        reclassify_buy = random.sample(
            list(weak_buy_indices), 
            min(int(len(weak_buy_indices) * 0.3), len(weak_buy_indices))
        )
        df.loc[reclassify_buy, 'target'] = 2  # –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ HOLD
    
    if len(weak_sell_indices) > 0:
        reclassify_sell = random.sample(
            list(weak_sell_indices), 
            min(int(len(weak_sell_indices) * 0.3), len(weak_sell_indices))
        )
        df.loc[reclassify_sell, 'target'] = 2  # –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ HOLD

else:
    print(f"‚úÖ –ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤ –ø—Ä–∏–µ–º–ª–µ–º—ã–π, –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞.")

–§–∞–π–ª: train_model.py - –∏–∑–º–µ–Ω–∏—Ç—å Focal Loss (—Å—Ç—Ä–æ–∫–∞ ~50)
–ó–ê–ú–ï–ù–ò–¢–¨:
# –ù–û–í–´–ô –ö–û–î - –ú–ï–ù–ï–ï –ê–ì–†–ï–°–°–ò–í–ù–´–ô FOCAL LOSS
def categorical_focal_loss(gamma=1.5, alpha=0.25):  # –£–º–µ–Ω—å—à–∞–µ–º gamma, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º alpha
    """
    –ú–µ–Ω–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è Focal Loss
    gamma=1.5 - —É–º–µ—Ä–µ–Ω–Ω–∞—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö
    alpha=0.25 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–µ—Å
    """
    def focal_loss_fixed(y_true, y_pred):
        epsilon = K.epsilon()
        y_pred = K.clip(y_pred, epsilon, 1. - epsilon)
        y_true = tf.cast(y_true, tf.float32)
        
        # –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –∫–ª–∞—Å—Å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –≤–µ—Å–∞
        # –£–º–µ–Ω—å—à–∞–µ–º –≤–µ—Å–∞ BUY/SELL, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å HOLD
        class_weights = tf.constant([0.8, 0.8, 1.4])  # BUY, SELL, HOLD
        weights = tf.reduce_sum(class_weights * y_true, axis=-1, keepdims=True)
        
        cross_entropy = -y_true * K.log(y_pred)
        loss = alpha * K.pow(1 - y_pred, gamma) * cross_entropy * weights
        
        return K.sum(loss, axis=-1)
    
    return focal_loss_fixed

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

üî• –ö–†–ò–¢–ò–ß–ù–û: –ò–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ BUY/SELL –º–µ—Ç–æ–∫ (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø–æ—Ä–æ–≥–∏)
üî• –ö–†–ò–¢–ò–ß–ù–û: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤ (—É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å HOLD)
üî• –ö–†–ò–¢–ò–ß–ù–û: –ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (–¥–æ–±–∞–≤–ª—è—Ç—å HOLD –≤–º–µ—Å—Ç–æ —É–±–∞–≤–ª–µ–Ω–∏—è)
üî¥ –í–ê–ñ–ù–û: –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Focal Loss

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞:

–ß–∞—â–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å HOLD (—É–≤–µ–ª–∏—á–∏—Ç—Å—è recall –¥–ª—è HOLD)
–†–µ–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
–£–ª—É—á—à–∏—Ç—å –æ–±—â—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –∫–æ–¥–µ!