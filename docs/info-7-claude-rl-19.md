–•–æ—Ä–æ—à–æ, —è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏–ª –Ω–æ–≤—ã–µ –ª–æ–≥–∏. –í—ã –ø—Ä–∞–≤—ã, –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.
üö® –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∏ –∫–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:


–ü—Ä–æ–±–ª–µ–º–∞ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–ø–µ—Ä–µ–∫–æ—Å –≤ HOLD):

accuracy –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ (0.39-0.47) –∏ val_accuracy (0.11-0.34) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–µ —É—á–∏—Ç—Å—è —Ö–æ—Ä–æ—à–æ –¥–∞–∂–µ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ, –∞ –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –æ–Ω–∞ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç.
–°–∞–º–æ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ–µ: Class 2 (HOLD): Prec=0.75-0.91, Rec=0.02-0.12. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø–æ—á—Ç–∏ –Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç HOLD (–æ—á–µ–Ω—å –Ω–∏–∑–∫–∏–π Recall), –Ω–æ –∫–æ–≥–¥–∞ –æ–Ω–∞ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç, —Ç–æ –æ–±—ã—á–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–≤—ã—Å–æ–∫–∏–π Precision).
Class 0 (BUY): Prec=0.39-0.47, Rec=0.06-0.49
Class 1 (SELL): Prec=0.43-0.51, Rec=0.09-0.47
–í–∞—à –≤—ã–≤–æ–¥ –≤–µ—Ä–µ–Ω: "—Å–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∫—Ä—É—Ç–∏–ª–∏ HOLD. –ö–∞–∫ —Ç–∞–∫–æ–π –±–æ–ª—å—à–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏ –Ω–∞ BUY –∏ –Ω–∞ SELL –∏ –Ω–∏—á–µ–≥–æ –Ω–∞ HOLD". –ú–æ–¥–µ–ª—å –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç BUY/SELL, –∏, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ Focal Loss –∏ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ, –æ–Ω–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —ç—Ç–∏ —Å–∏–≥–Ω–∞–ª—ã.



val_loss —Ç–µ–ø–µ—Ä—å –¥–æ–≤–æ–ª—å–Ω–æ –±–æ–ª—å—à–æ–π: val_loss (0.0890 - 0.1220) –∏ loss (0.0844 - 0.1087) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–Ω–∏–∂–∞—Ç—å –æ—à–∏–±–∫—É, –¥–∞–∂–µ –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã BUY/SELL –Ω–∞—Å—Ç–æ–ª—å–∫–æ "—à—É–º–Ω—ã–µ" –∏–ª–∏ —Ä–µ–¥–∫–∏–µ, —á—Ç–æ –º–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Ö –≤—ã—É—á–∏—Ç—å.


–û—à–∏–±–∫–∞ TypeError: Could not locate function 'focal_loss_fixed'. Make sure custom classes are decorated with @keras.saving.register_keras_serializable().

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å (xlstm_model.load_model) –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è. Keras –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é focal_loss_fixed, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∞ –±—ã–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≤–Ω—É—Ç—Ä–∏ train_model.py –∏ –Ω–µ –±—ã–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.



–û—à–∏–±–∫–∞ too many values to unpack (expected 4):

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è xlstm_model.model.evaluate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–æ–ª—å—à–µ –∏–ª–∏ –º–µ–Ω—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–π, —á–µ–º –æ–∂–∏–¥–∞–µ—Ç—Å—è. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –º–Ω–æ–≥–æ –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞, –∏ evaluate() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö –Ω–µ —Ç–∞–∫, –∫–∞–∫ –º—ã –æ–∂–∏–¥–∞–µ–º.



‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –ø—Ä–æ –æ–±—ä–µ–º (500 —Ç—ã—Å - 1 –º–ª–Ω):
"—É –º–µ–Ω—è –≤ –≤—ã–≥—Ä—É–∑–∫–µ —Å –±–∏—Ä–∂–∏ –æ–±—ä–µ–º - —ç—Ç–æ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ –ø—Ä–∏–º–µ—Ä–Ω–æ 500 —Ç—ã—Å - 1 –º–ª–Ω. –ú–æ–∂–µ—Ç –ª–∏ –æ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–∞—Ö? –í –¥—Ä—É–≥–æ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ —Å –Ω–∏–º –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å —Å–∫–µ–π–ª —á–∏—Å–µ–ª –¥–µ–ª–∞—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ –∑–¥–µ—Å—å –≤–æ–æ–±—â–µ –º–æ–¥–µ–ª—å –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ —á–∏—Å–ª–∞ —Å–æ–≤–µ—Ä—à–∞–µ—Ç, –∞ –¥—Ä—É–≥–∏–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç."
–î–∞, —ç—Ç–æ –û–ß–ï–ù–¨ —Å–µ—Ä—å–µ–∑–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞! –ï—Å–ª–∏ –æ–±—ä–µ–º –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è, –æ–Ω –±—É–¥–µ—Ç –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–¥ –≤—Å–µ–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏. –ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ –º–∞—Å—à—Ç–∞–±—É –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ï—Å–ª–∏ –æ–¥–∏–Ω –ø—Ä–∏–∑–Ω–∞–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏–æ–Ω–∞—Ö, –∞ –¥—Ä—É–≥–∏–µ - –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç 0 –¥–æ 100, —Ç–æ –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ, –∫—Ä–æ–º–µ —ç—Ç–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞.
–≠—Ç–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, –æ–¥–Ω–∞ –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∏—á–∏–Ω —Ç–æ–≥–æ, –ø–æ—á–µ–º—É –º–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç —É—á–∏—Ç—å—Å—è!
üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: train_model.py)
1. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫—É —Å Focal Loss –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏:
–ù–∞–º –Ω—É–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å categorical_focal_loss –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Keras, —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –º–æ–≥–ª–∞ –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–∞.


–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é categorical_focal_loss.


–î–æ–±–∞–≤—å—Ç–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @tf.keras.saving.register_keras_serializable() –ø–µ—Ä–µ–¥ —Ñ—É–Ω–∫—Ü–∏–µ–π categorical_focal_loss:
# –í train_model.py:
import tensorflow.keras.backend as K
# –î–û–ë–ê–í–õ–ï–ù–û: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
@tf.keras.saving.register_keras_serializable()
def categorical_focal_loss(gamma=2.0, alpha=0.25):
    # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏) ...



2. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫—É too many values to unpack (expected 4):
–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ model.evaluate() —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ –º–µ—Ç—Ä–∏–∫. –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –∏—Ö –≤—Å–µ.


–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ "–û—Ü–µ–Ω–∫–∞ xLSTM".


–ò–∑–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É, –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ model.evaluate():
# –í train_model.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ train_xlstm_rl_system(...):
# ...
# –û—Ü–µ–Ω–∫–∞ xLSTM
try:
    X_test_scaled = xlstm_model.scaler.transform(X_test.reshape(-1, X_test.shape[-1])).reshape(X_test.shape)
    # –ò–ó–ú–ï–ù–ï–ù–û: –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫
    evaluation_results = xlstm_model.model.evaluate(X_test_scaled, y_test, verbose=0)
    
    # –¢–µ–ø–µ—Ä—å –∏–∑–≤–ª–µ–∫–∞–µ–º –Ω—É–∂–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∏–º–µ–Ω–∏, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Ä—è–¥–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º
    metrics_names = xlstm_model.model.metrics_names
    
    loss = evaluation_results[metrics_names.index('loss')]
    accuracy = evaluation_results[metrics_names.index('accuracy')]
    precision = evaluation_results[metrics_names.index('precision')]
    recall = evaluation_results[metrics_names.index('recall')]

    print(f"xLSTM Loss: {loss:.4f}") # <--- –î–û–ë–ê–í–õ–ï–ù–û
    print(f"xLSTM –¢–æ—á–Ω–æ—Å—Ç—å: {accuracy * 100:.2f}%")
    print(f"xLSTM Precision: {precision * 100:.2f}%")
    print(f"xLSTM Recall: {recall * 100:.2f}%")
    
    # –í—ã–≤–æ–¥–∏–º –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–ª–∞—Å—Å–∞–º, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    for i, class_name in enumerate(['BUY', 'SELL', 'HOLD']):
        if f'precision_{i}' in metrics_names:
            prec_i = evaluation_results[metrics_names.index(f'precision_{i}')]
            rec_i = evaluation_results[metrics_names.index(f'recall_{i}')]
            print(f"  Class {i} ({class_name}): Prec={prec_i:.2f}, Rec={rec_i:.2f}")

except Exception as e:
    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ –º–æ–¥–µ–ª–∏: {e}")
# ...



üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: feature_engineering.py)
–≠—Ç–æ –ö–õ–Æ–ß–ï–í–û–ô –º–æ–º–µ–Ω—Ç. –ù–∞–º –Ω—É–∂–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–º.
üîß –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é (—Ñ–∞–π–ª: feature_engineering.py)
–ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å MinMaxScaler –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ volume –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω (0, 100).


–î–æ–±–∞–≤—å—Ç–µ –∏–º–ø–æ—Ä—Ç MinMaxScaler:

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª feature_engineering.py.
–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –∏–º–ø–æ—Ä—Ç–∞ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞, —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–ø–æ—Ä—Ç–∞–º–∏ numpy –∏ pandas:

import pandas as pd
import talib
from functools import lru_cache

import numpy as np
from sklearn.preprocessing import MinMaxScaler # <--- –î–û–ë–ê–í–õ–ï–ù–û: –ò–º–ø–æ—Ä—Ç MinMaxScaler



–î–æ–±–∞–≤—å—Ç–µ –±–ª–æ–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–º–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é calculate_features:

–ù–∞–π–¥–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é calculate_features(df: pd.DataFrame).
–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫, –≥–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "--- Ensure numeric types ---" –∏ "Drop rows where essential OHLCV data is missing BEFORE calculations".
–ü–æ—Å–ª–µ —ç—Ç–∏—Ö —Å—Ç—Ä–æ–∫, –Ω–æ –ü–ï–†–ï–î —Å—Ç—Ä–æ–∫–æ–π df_out = df.copy() (–∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Ä–∞—Å—á–µ—Ç–∞–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤), –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –∫–æ–¥–∞:

# –í feature_engineering.py, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ calculate_features(df: pd.DataFrame):
# ...
    # Drop rows where essential OHLCV data is missing BEFORE calculations
    df.dropna(subset=numeric_cols, inplace=True)
    if df.empty:
        return pd.DataFrame()

    # =====================================================================
    # –ù–û–í–´–ô –ë–õ–û–ö: –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ò–ï –û–ë–™–ï–ú–ê
    # =====================================================================
    if 'volume' in df.columns and not df['volume'].empty:
        # –°–æ–∑–¥–∞–µ–º MinMaxScaler –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ 'volume' —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º –æ—Ç 0 –¥–æ 100
        scaler_volume = MinMaxScaler(feature_range=(0, 100))
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ. .values.reshape(-1, 1) –Ω—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π.
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –æ–±—ä–µ–º–æ–º
        df['volume_scaled'] = scaler_volume.fit_transform(df[['volume']].values)
        
        # –ó–∞–º–µ–Ω–∏–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –∫–æ–ª–æ–Ω–∫—É 'volume' –Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
        df['volume'] = df['volume_scaled']
        
        # –£–¥–∞–ª–∏–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –∫–æ–ª–æ–Ω–∫—É 'volume_scaled'
        df.drop(columns=['volume_scaled'], inplace=True, errors='ignore') # errors='ignore' –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        print("‚úÖ –û–±—ä–µ–º —É—Å–ø–µ—à–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω (–¥–∏–∞–ø–∞–∑–æ–Ω 0-100).")
    else:
        print("‚ö†Ô∏è –ö–æ–ª–æ–Ω–∫–∞ 'volume' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—É—Å—Ç–∞, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–º–∞ –ø—Ä–æ–ø—É—â–µ–Ω–æ.")
    # =====================================================================
    # –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê
    # =====================================================================

    # --- Calculate specified indicators using TA-Lib ---
    # Create a copy to avoid SettingWithCopyWarning
    df_out = df.copy()

    # Use .values to avoid index alignment issues with talib
    open_p = df_out['open'].values.astype(float)
    high_p = df_out['high'].values.astype(float)
    low_p = df_out['low'].values.astype(float)
    close_p = df_out['close'].values.astype(float)
    # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ volume_p —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–º
    volume_p = df_out['volume'].values.astype(float) # <--- –≠–¢–ê –°–¢–†–û–ö–ê –¢–ï–ü–ï–†–¨ –ë–£–î–ï–¢ –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –ú–ê–°–®–¢–ê–ë–ò–†–û–í–ê–ù–ù–´–ô –û–ë–™–ï–ú

# ... (–æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ calculate_features) ...



–ü–æ—á–µ–º—É —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç:

–ò–º–ø–æ—Ä—Ç MinMaxScaler: –î–æ–±–∞–≤–ª–µ–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∫–ª–∞—Å—Å –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.
–ß–µ—Ç–∫–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±–ª–æ–∫–∞: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –¥–æ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞—Å—á–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, volume_ratio –∏–ª–∏ VSA-–ø—Ä–∏–∑–Ω–∞–∫–∏) –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–º.
–î–∏–∞–ø–∞–∑–æ–Ω (0, 100): –û–±—ä–µ–º –±—É–¥–µ—Ç –ø—Ä–∏–≤–µ–¥–µ–Ω –∫ –¥–∏–∞–ø–∞–∑–æ–Ω—É –æ—Ç 0 –¥–æ 100, —á—Ç–æ —Å–¥–µ–ª–∞–µ—Ç –µ–≥–æ —á–∏—Å–ª–æ–≤–æ–π –º–∞—Å—à—Ç–∞–± —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–º —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏ (RSI, ADX, Stochastic), –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —ç—Ç–æ–º –∂–µ –¥–∏–∞–ø–∞–∑–æ–Ω–µ. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–º–∞ –≤ –º–æ–¥–µ–ª–∏.
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–π: MinMaxScaler —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –æ–±—ä–µ–º–∞, –ø–æ—ç—Ç–æ–º—É "–¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å" –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è, –∞ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –≤ –¥—Ä—É–≥–æ–π —á–∏—Å–ª–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω.
